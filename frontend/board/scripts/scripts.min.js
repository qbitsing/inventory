"use strict";angular.module("frontendApp",["ui.router","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ngTouch","LocalStorageModule","perfect_scrollbar","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pagination","ui.grid.cellNav","mdo-angular-cryptography","uiCropper","ui.materialize","io-barcode"]).config(["localStorageServiceProvider",function(localStorageServiceProvider){localStorageServiceProvider.setPrefix("inventoryPrinesApp").setStorageType("sessionStorage").setNotify(!0,!0)}]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/Login/InicioSesion"),$stateProvider.state("plain",{abstract:!0,url:"",templateUrl:"views/layouts/plain.html"}).state("Login",{url:"/Login",parent:"plain",templateUrl:"views/layouts/login.html",controller:"LoginCtrl"}).state("Restaurar",{url:"/Restaurar",parent:"Login",templateUrl:"views/pages/restaurar.html",controller:"RestaurarCtrl"}).state("InicioSesion",{url:"/InicioSesion",parent:"Login",templateUrl:"views/pages/inicio_sesion.html",controller:"IniciosesionCtrl"}).state("Home",{url:"/Home",parent:"Dashboard",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("Dashboard",{url:"/Dashboard",parent:"plain",templateUrl:"views/layouts/dashboard.html",controller:"DashboardCtrl"}).state("Perfil",{url:"/Perfil",parent:"Dashboard",templateUrl:"views/pages/perfil.html",controller:"PerfilCtrl"}).state("Entrada",{url:"/Entrada",parent:"Dashboard",templateUrl:"views/pages/entrada.html",controller:"EntradaCtrl"}).state("Salida",{url:"/Salida",parent:"Dashboard",templateUrl:"views/pages/salida.html",controller:"SalidaCtrl"}).state("Personas",{url:"/Personas",parent:"Dashboard",templateUrl:"views/pages/personas.html",controller:"PersonasCtrl"}).state("Productos",{url:"/Productos",parent:"Dashboard",templateUrl:"views/pages/productos.html",controller:"ProductosCtrl"}).state("Empleados",{url:"/Empleados",parent:"Dashboard",templateUrl:"views/pages/empleados.html",controller:"EmpleadosCtrl"}).state("Fabricacion",{url:"/Fabricacion",parent:"Dashboard",templateUrl:"views/pages/fabricacion.html",controller:"FabricacionCtrl"}).state("OrdenVenta",{url:"/OrdenVenta",parent:"Dashboard",templateUrl:"views/pages/orden_venta.html",controller:"OrdenVentaCtrl"}).state("OrdenCompra",{url:"/OrdenCompra",parent:"Dashboard",templateUrl:"views/pages/orden_compra.html",controller:"OrdenCompraCtrl"}).state("MateriaPrima",{url:"/MateriaPrima",parent:"Dashboard",templateUrl:"views/pages/materia_prima.html",controller:"MateriaPrimaCtrl"}).state("Factura",{url:"/Factura/:_id",parent:"Dashboard",templateUrl:"views/pages/factura.html",controller:"FacturaCtrl"}).state("Balance",{url:"/Balance",parent:"Dashboard",templateUrl:"views/pages/valance.html",controller:"ValanceCtrl"}).state("Historial",{url:"/Historial",parent:"Dashboard",templateUrl:"views/pages/historial.html",controller:"HistorialCtrl"})}]),angular.module("frontendApp").controller("IniciosesionCtrl",["$scope","webServer","SesionUsuario","$state","preloader",function($scope,webServer,SesionUsuario,$state,preloader){$scope.preloader=preloader,$scope.preloader.estado=!1,null!=SesionUsuario.ObtenerSesion()&&$state.go("Home"),$scope.userLogin={},$scope.login=function(){$scope.preloader.estado=!0,webServer.getResource("personas/login",$scope.userLogin,"post").then(function(data){$scope.preloader.estado=!1,SesionUsuario.CrearSesion(data.data.datos)&&$state.go("Home")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}}]),angular.module("frontendApp").service("webServer",["$http",function($http){return{getResource:function(resource,data,metodo){var URL="http://192.168.128.7:5000/"+resource;if(void 0==data&&(data={}),"get"==metodo){var req={method:"GET",url:URL,params:data};return $http(req)}if("post"==metodo){var req={method:"POST",url:URL,data:data};return $http(req)}return"put"==metodo?$http.put(URL,data):"delete"==metodo?$http.delete(URL,data):void 0}}}]),angular.module("frontendApp").service("SesionUsuario",["localStorageService",function(localStorageService){return{CrearSesion:function(user){return user.super_administrador?user.rol="Super Administrador":user.contador?user.rol="Contador":user.almacenista?user.rol="Almacenista":user.empleado&&(user.rol="Empleado"),localStorageService.set("Usuario",user),!0},ObtenerSesion:function(){return localStorageService.get("Usuario")},CerrarSesion:function(){return localStorageService.remove("Usuario")},ActualizarSesion:function(user){localStorageService.set("Usuario",user)}}}]),angular.module("frontendApp").controller("HomeCtrl",["$scope",function($scope){}]),angular.module("frontendApp").directive("sidenavb",function(){return{templateUrl:"views/directives/sidenav.html",restrict:"E",link:function(scope,element,attrs){},controller:"DashboardCtrl"}}),angular.module("frontendApp").directive("topnav",function(){return{templateUrl:"views/directives/topnav.html",restrict:"E",link:function(scope,element,attrs){},controller:"DashboardCtrl"}}),angular.module("frontendApp").controller("DashboardCtrl",["$scope","socket","$state","SesionUsuario","webServer","Tabla","BotonesTabla","preloader","server",function($scope,socket,$state,SesionUsuario,webServer,Tabla,BotonesTabla,preloader,server){function listarResolucion(){webServer.getResource("resolucion",{},"get").then(function(data){$scope.resolucion=data.data.datos},function(data){$scope.resolucion={}})}function listarProcesos(){webServer.getResource("procesos",{},"get").then(function(data){$scope.Procesos=data.data.datos,$scope.gridOptionsModalProcesos.data=$scope.Procesos,listarResolucion()},function(data){$scope.Procesos=[],$scope.gridOptionsModalProcesos.data=$scope.Procesos,listarResolucion()})}function listarCategorias(){webServer.getResource("categorias",{},"get").then(function(data){$scope.Categorias=data.data.datos,$scope.gridOptionsModalCategorias.data=$scope.Categorias,listarProcesos()},function(data){$scope.Categorias=[],$scope.gridOptionsModalCategorias.data=$scope.Categorias,listarProcesos()})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}if($(document).ready(function(){$(".modal").modal(),$("#modal1").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!0,$scope.categorias=!1,$scope.procesos=!1},complete:function(){}}),$("#modal2").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!1,$scope.categorias=!0,$scope.procesos=!1},complete:function(){}}),$("#modal3").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!1,$scope.categorias=!1,$scope.procesos=!0},complete:function(){}}),$("#modal4").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"10%",complete:function(){}})}),$scope.preloader=preloader,$scope.$state=$state,$scope.server=server,$scope.categoria={},null==SesionUsuario.ObtenerSesion())$state.go("InicioSesion");else{$scope.Usuario=SesionUsuario.ObtenerSesion(),$scope.NombreDeUsuario="";for(var i=0,contador=0;0==i;)if(contador<$scope.Usuario.nombre.length){var caracter=$scope.Usuario.nombre.charAt(contador);" "==caracter?i=1:$scope.NombreDeUsuario+=caracter,contador++}else i=1;if($scope.Usuario.apellidos)for($scope.NombreDeUsuario+=" ",i=0,contador=0;0==i;)if(contador<$scope.Usuario.apellidos.length){var caracter=$scope.Usuario.apellidos.charAt(contador);" "==caracter?i=1:$scope.NombreDeUsuario+=caracter,contador++}else i=1}$scope.TituloPanelCategorias="Registro de Categorias",$scope.TituloBotonCategorias="Registrar Categoria";var casillaDeBotonesModalCategorias="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalCategorias={columnDefs:[{field:"nombre",width:"30%",minWidth:200},{field:"codigo",width:"30%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalCategorias,width:"40%",minWidth:200}]},angular.extend($scope.gridOptionsModalCategorias,Tabla),$scope.TituloPanelUnidades="Registro de Unidades de Medida",$scope.TituloBotonUnidades="Registrar Unidad de Medida";var casillaDeBotonesModalUnidades="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalUnidades={columnDefs:[{field:"nombre",width:"50%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalUnidades,width:"50%",minWidth:200}]},angular.extend($scope.gridOptionsModalUnidades,Tabla),$scope.TituloPanelProcesos="Registro de procesos de fabricación",$scope.TituloBotonProcesos="Registrar Proceso";var casillaDeBotonesModalProcesos="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalProcesos={columnDefs:[{field:"nombre",width:"33%",minWidth:200},{field:"interno o externo",cellTemplate:"<div> Proceso {{row.entity.tipo}}</div>",width:"33%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalProcesos,width:"34%",minWidth:200}]},angular.extend($scope.gridOptionsModalProcesos,Tabla),$scope.EnviarUnidad=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Unidades de Medida"==$scope.TituloPanelUnidades?(ruta="unidades",metodo="post"):(ruta="unidades/"+$scope.Unidad_de_medida._id,metodo="put"),webServer.getResource(ruta,$scope.Unidad_de_medida,metodo).then(function(data){"Registro de Unidades de Medida"==$scope.TituloPanelUnidades?($scope.Unidad_de_medida._id=data.data.datos._id,$scope.Unidades.unshift($scope.Unidad_de_medida)):$scope.Unidades[$scope.Unidad_de_medida.index]=$scope.Unidad_de_medida,$scope.Unidad_de_medida={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.EnviarCategoria=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Categorias"==$scope.TituloPanelCategorias?(ruta="categorias",metodo="post"):(ruta="categorias/"+$scope.categoria._id,metodo="put"),webServer.getResource(ruta,$scope.categoria,metodo).then(function(data){"Registro de Categorias"==$scope.TituloPanelCategorias?($scope.categoria._id=data.data.datos._id,$scope.categoria.codigo=data.data.datos.codigo,$scope.Categorias.unshift($scope.categoria)):$scope.Categorias[$scope.categoria.index]=$scope.categoria,$scope.categoria={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.EditarModal=function(_id){var obj;$scope.categorias?($scope.Categorias.forEach(function(ele,index){ele._id==_id&&(obj={_id:ele._id,nombre:ele.nombre,codigo:ele.codigo})}),$scope.categoria=obj,$scope.TituloPanelCategorias="Edición de Categorias",$scope.TituloBotonCategorias="Editar Categoria"):$scope.unidades?($scope.Unidades.forEach(function(ele,index){ele._id==_id&&(obj={_id:ele._id,nombre:ele.nombre,codigo:ele.codigo})}),$scope.Unidad_de_medida=obj,$scope.TituloPanelUnidades="Edición de Unidades de Medida",$scope.TituloBotonUnidades="Editar Unidad de Medida"):$scope.procesos&&($scope.Procesos.forEach(function(ele,index){ele._id==_id&&(obj={_id:ele._id,nombre:ele.nombre,tipo:ele.tipo,proceso_consecutivo:ele.proceso_consecutivo})}),$scope.proceso=obj,$scope.TituloPanelProcesos="Edición de Procesos",$scope.TituloBotonProcesos="Editar Proceso")},$scope.Cancelar=function(){$scope.categorias?($scope.TituloPanelCategorias="Registro de Categorias",$scope.TituloBotonCategorias="Registrar Categoria",$scope.categoria={}):$scope.unidades?($scope.TituloPanelUnidades="Registro de Unidades de Medida",$scope.TituloBotonUnidades="Registrar Unidad de Medida",$scope.Unidad_de_medida={}):$scope.procesos&&($scope.TituloPanelProcesos="Registro de procesos de fabricación",$scope.TituloBotonProcesos="Registrar Proceso",$scope.proceso={})},function(){webServer.getResource("unidades",{},"get").then(function(data){$scope.Unidades=data.data.datos,$scope.gridOptionsModalUnidades.data=$scope.Unidades,listarCategorias()},function(data){$scope.Unidades=[],$scope.gridOptionsModalUnidades.data=$scope.Unidades,listarCategorias()})}(),$scope.validarNumeroDesde=function(){$scope.resolucion.desde<0&&($scope.resolucion.desde=0)},$scope.EnviarProceso=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de procesos de fabricación"==$scope.TituloPanelProcesos?(ruta="procesos",metodo="post"):(ruta="procesos/"+$scope.proceso._id,metodo="put"),webServer.getResource(ruta,$scope.proceso,metodo).then(function(data){"Registro de procesos de fabricación"==$scope.TituloPanelProcesos?($scope.proceso._id=data.data.datos._id,$scope.proceso.proceso_consecutivo=data.data.datos.proceso_consecutivo,$scope.Procesos.unshift($scope.proceso)):$scope.Procesos[$scope.proceso.index]=$scope.proceso,$scope.proceso={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.EnviarResolucion=function(){$scope.resolucion.hasta>$scope.resolucion.desde?($scope.preloader.estado=!0,webServer.getResource("resolucion",$scope.resolucion,"post").then(function(data){$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})):(Materialize.toast("El número 'Hasta:' debe ser mayor al número 'Desde:'",4e3),$("#hastaResolucion").focus())},$scope.sidenav=function(){angular.element(".sidenav").toggleClass("sidenav-hidden"),angular.element(".top-nav").toggleClass("top-nav-hidden"),angular.element(".titulo-pagina").toggleClass("titulo-pagina-hidden"),angular.element(".perfil").toggleClass("perfil-hidden"),angular.element(".main-view").toggleClass("main-view-full"),angular.element(".side-nav>ul>li").click(function(event){screen.width<=600&&(angular.element(".sidenav").addClass("sidenav-hidden"),angular.element(".top-nav").addClass("top-nav-hidden"),angular.element(".perfil").addClass("perfil-hidden"),angular.element(".main-view").addClass("main-view-full"))})},$scope.active=!0,$scope.cerrarSesion=function(){SesionUsuario.CerrarSesion(),$state.go("InicioSesion"),$scope.preloader.estado=!1},angular.element(".side-nav>ul>li").click(function(){scroll()})}]),angular.module("frontendApp").controller("ProductosCtrl",["$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function listarInsumos(){webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.Insumos=data.data.datos,listarProductosSelect()},function(data){$scope.Insumos=[],listarProductosSelect()})}function listarProductosSelect(){webServer.getResource("productos",{producto:!0},"get").then(function(data){$scope.ProductosSelect=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.ProductosSelect=[],$scope.preloader.estado=!1})}function Borrar(id){webServer.getResource("productos/"+id,{},"delete").then(function(data){$scope.Productos.forEach(function(ele,index){ele._id==id&&$scope.Productos.splice(index,1)}),$scope.ProductosSelect.forEach(function(ele,index){ele._id==id&&$scope.ProductosSelect.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarProducto(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,nombre:ele.nombre,unidad_medida:ele.unidad_medida,min_stock:ele.min_stock,cantidad:ele.cantidad,marca:ele.marca,categoria:ele.categoria,Insumos:ele.Insumos,procesos:ele.procesos,productos:ele.productos,precio:ele.precio,producto_consecutivo:ele.producto_consecutivo,codigo:ele.codigo,tipo:ele.tipo,fabricado:ele.fabricado,comprado:ele.comprado})}),obj}$scope.productBarCode=[],$scope.bc={lineColor:"#000000",height:50,displayValue:!0,fontSize:10},$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.panelAnimate="",$scope.pageAnimate="",$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto",$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.producto={},$scope.producto.Insumo={},$scope.Kit={},$scope.Kit.producto={},$scope.check="producto";var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editar+BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{field:"codigo",width:"15%",minWidth:160},{field:"nombre",width:"15%",minWidth:160},{field:"marca",width:"15%",minWidth:160},{name:"categoria",field:"categoria.nombre",width:"15%",minWidth:160},{name:"cantidad",width:"20%",cellTemplate:"<div>{{row.entity.cantidad}} {{row.entity.unidad_medida.nombre}}</div>",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),function(){$scope.preloader.estado=!0,webServer.getResource("productos",{producto:!0,kit:!0},"get").then(function(data){data.data?($scope.Productos=data.data.datos,$scope.gridOptions.data=$scope.Productos):($scope.Productos=[],$scope.gridOptions.data=$scope.Productos),listarInsumos()},function(data){$scope.Productos=[],$scope.gridOptions.data=$scope.Productos,listarInsumos()})}(),$scope.cargarProducto=function(){$scope.Productos.forEach(function(ele,index){$scope.Kit.codigo==ele.codigo&&($scope.Kit.producto._id=ele._id+","+ele.nombre),13===keyEvent.which&&$("#Cantidad").focus()})},$scope.detectar=function(keyEvent){$scope.Kit.producto.cantidad>0&&13===keyEvent.which&&""!=$scope.Kit.producto._id&&$scope.Agregarkit()},$scope.AgregarInsumo=function(){var controlador=!1,obj={_id:$scope.producto.Insumo._id.split(",")[0],nombre:$scope.producto.Insumo._id.split(",")[1],cantidad:$scope.producto.Insumo.cantidad};$scope.Producto.Insumos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El insumo ya esta añadido",4e3):$scope.Producto.Insumos.push(obj),$scope.producto.Insumo._id="",$scope.producto.Insumo.cantidad=0},$scope.AgregarProceso=function(){var controlador=!1,obj={_id:$scope.proceso._id.split(",")[0],nombre:$scope.proceso._id.split(",")[1],tipo:$scope.proceso._id.split(",")[2]};$scope.Producto.procesos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El proceso ya esta añadido",4e3):$scope.Producto.procesos.push(obj),$scope.proceso={}},$scope.Borrarproceso=function(index){$scope.Producto.procesos.splice(index,1)},$scope.Borrarproducto=function(index){$scope.Producto.Insumos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar el producto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.Agregarkit=function(){if(""!=$scope.Kit.producto._id&&$scope.Kit.producto.cantidad>0){var controlador=!1,obj={_id:$scope.Kit.producto._id.split(",")[0],nombre:$scope.Kit.producto._id.split(",")[1],cantidad:$scope.Kit.producto.cantidad};$scope.Producto.productos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El producto ya esta añadido",4e3):($scope.Producto.productos.push(obj),$("#codigo_barras").focus()),$scope.Kit.producto={},$scope.Kit.producto._id="",$scope.Kit.producto.cantidad=0}},$scope.Borrarkit=function(index){$scope.Producto.productos.splice(index,1)},$scope.cambiar=function(){$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.producto={},$scope.producto.Insumo={},$scope.Kit={},$scope.Kit.producto={},$scope.Kit.producto._id="",$scope.Kit.producto.cantidad=0},$scope.EnviarProducto=function(){$scope.preloader.estado=!0;var ruta="",metodo="";$scope.Categorias.forEach(function(ele,index){$scope.Producto.categoria._id==ele._id&&($scope.Producto.categoria=ele)}),"kit"==$scope.check?($scope.Producto.Insumos=null,$scope.Producto.tipo="kit"):($scope.Producto.tipo="producto",$scope.Unidades.forEach(function(ele,index){ele._id==$scope.Producto.unidad_medida._id&&($scope.Producto.unidad_medida=ele)})),"Registro de Productos"==$scope.panel_title_form?(ruta="productos",metodo="post"):(ruta="productos/"+$scope.Producto._id,metodo="put"),webServer.getResource(ruta,$scope.Producto,metodo).then(function(data){"Registro de Productos"==$scope.panel_title_form?($scope.Producto._id=data.data.datos._id,$scope.Producto.producto_consecutivo=data.data.datos.producto_consecutivo,"producto"==$scope.check&&($scope.Producto.codigo=data.data.datos.codigo,$scope.ProductosSelect.unshift($scope.Producto)),$scope.Productos.unshift($scope.Producto)):($scope.Productos[$scope.Producto.index]=$scope.Producto,"producto"==$scope.check&&$scope.ProductosSelect.forEach(function(ele,index){ele._id==$scope.Producto._id&&($scope.ProductosSelect[$scope.Producto.index]=$scope.Producto)}),$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto"),$scope.Producto={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.check="producto",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.panel_title_form="Edicion de Producto",$scope.button_title_form="Actualizar Producto",$scope.Producto=IdentificarProducto(id,$scope.Productos),"kit"==$scope.Producto.tipo?$scope.check="kit":$scope.check="producto",scroll()},$scope.Detalles=function(id){$scope.Detalle=$scope.Productos.find(function(ele){if(ele._id==id)return ele}),$("#modalDetalles").modal("open")},$scope.CancelarEditar=function(){$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.producto={},$scope.producto.Insumo={},$scope.Kit={},$scope.Kit.producto={},$scope.Kit.producto._id="",$scope.Kit.producto.cantidad=0,$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto"},$scope.validarNumeroMinStock=function(){$scope.Producto.min_stock<0&&($scope.Producto.min_stock=0)},$scope.validarNumeroPrecio=function(){$scope.Producto.precio<0&&($scope.Producto.precio=0)},$scope.validarNumeroCantidad=function(){$scope.Producto.cantidad<0&&($scope.Producto.cantidad=0)},$scope.validarNumeroInsumo=function(){$scope.producto.Insumo.cantidad<0&&($scope.producto.Insumo.cantidad=0)},$scope.openModalBarCode=function(){$("#modalBarCode").modal("open")},$scope.addProductBarCode=function(){var pro=JSON.parse($scope.productBarCodeId),bandera=!0;if($scope.productBarCode.forEach(function(ele){if(ele.producto._id==pro._id)return bandera=!1}),bandera){pro.barcodes=[];for(var i=0;i<$scope.productBarCodeCant;i++)pro.barcodes.push({code:pro.codigo});$scope.productBarCode.push({producto:pro,cantidad:$scope.productBarCodeCant})}$scope.productBarCodeCant=null,$scope.productBarCodeId=null},$scope.printBarCodes=function(){var container=document.getElementById("containerBarCodesToPrint"),newWindow=window.open();newWindow.document.open(),newWindow.document.appendChild(container),newWindow.print(),newWindow.close(),document.getElementById("superContainer").appendChild(container),$scope.productBarCode=[]}}]),angular.module("frontendApp").controller("PersonasCtrl",["$state","$scope","$timeout","webServer","Tabla","BotonesTabla","preloader",function($state,$scope,$timeout,webServer,Tabla,BotonesTabla,preloader){function Borrar(id){webServer.getResource("personas/"+id,{},"delete").then(function(data){$scope.Personas.forEach(function(ele,index){ele._id==id&&$scope.Personas.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function listarCiudades(){webServer.getResource("ciudades",{},"get").then(function(data){$scope.Ciudades=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Ciudades=[],$scope.preloader.estado=!1})}function listarDepartamentos(){webServer.getResource("departamentos",{},"get").then(function(data){data.data.datos?($scope.Departamentos=data.data.datos,$scope.Persona.departamento=$scope.Departamentos[0]._id):$scope.Departamentos=[],listarCiudades()},function(data){$scope.Departamentos=[],listarCiudades()})}function IdentificarPersona(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,documento:ele.documento,nombre:ele.nombre,apellidos:ele.apellidos,direccion:ele.direccion,telefono:ele.telefono,correo:ele.correo,proveedor:ele.proveedor,proveedorfabricacion:ele.proveedorfabricacion,proveedorproductos:ele.proveedorproductos,cliente:ele.cliente,ciudad:ele.ciudad,contacto:ele.contacto,fax:ele.fax})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Almacenista"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona",$scope.Persona={},$scope.Persona.proveedor=!1;var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editar+BotonesTabla.Borrar+"</div>";$scope.gridOptions={columnDefs:[{name:"documento o nit",field:"documento",width:"20%",minWidth:160},{field:"nombre",width:"20%",minWidth:160},{field:"telefono",width:"20%",minWidth:160},{field:"contacto",width:"20%",minWidth:160},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"20%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.EnviarPersona=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de clientes y proveedores"==$scope.panel_title_form?(ruta="personas",metodo="post"):(ruta="personas/"+$scope.Persona._id,metodo="put"),$scope.Persona.proveedor||($scope.Persona.proveedorproductos=!1,$scope.Persona.proveedorfabricacion=!1),webServer.getResource(ruta,$scope.Persona,metodo).then(function(data){"Registro de clientes y proveedores"==$scope.panel_title_form?($scope.Persona._id=data.data.datos._id,$scope.Personas.unshift($scope.Persona)):$scope.Personas[$scope.Persona.index]=$scope.Persona,$scope.Persona={},$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar esta persona de la base de datos?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.Detalles=function(id){$scope.Detalle=$scope.Personas.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.rol="",$scope.Detalle.cliente&&($scope.Detalle.rol="Cliente"),$scope.Detalle.proveedor&&(""!=$scope.Detalle.rol&&($scope.Detalle.rol+=", "),$scope.Detalle.rol+="Proveedor"),$scope.Detalle.rol+=".",$("#modalDetalles").modal("open")},$scope.Editar=function(id){$scope.panel_title_form="Edicion de clientes y proveedores",$scope.button_title_form="Actualizar Persona",$scope.Persona=IdentificarPersona(id,$scope.Personas),scroll(),$scope.Persona.ciudad&&($scope.Persona.departamento=$scope.Persona.ciudad.departamento._id)},$scope.CancelarEditar=function(){$scope.Persona={},$scope.Persona.proveedor=!1,$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona"},$scope.validarNumeroTelefono=function(id){$scope.Persona.telefono<0&&($scope.Persona.telefono=0)},$scope.validarNumeroFax=function(id){$scope.Persona.fax<0&&($scope.Persona.fax=0)},function(){$scope.preloader.estado=!0,webServer.getResource("personas",{proveedor:!0,cliente:!0},"get").then(function(data){$scope.Personas=data.data.datos,$scope.gridOptions.data=data.data.datos,listarDepartamentos()},function(data){$scope.Personas=[],listarDepartamentos()})}()}]),angular.module("frontendApp").controller("EmpleadosCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader","server",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader,server){function Borrar(id){webServer.getResource("personas/"+id,{},"delete").then(function(data){$scope.Empleados.forEach(function(ele,index){ele._id==id&&$scope.Empleados.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarPersona(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,documento:ele.documento,nombre:ele.nombre,apellidos:ele.apellidos,direccion:ele.direccion,telefono:ele.telefono,correo:ele.correo,super_administrador:ele.super_administrador,almacenista:ele.almacenista,contador:ele.contador,empleado:ele.empleado,cargo:ele.cargo,myImage:ele.Image})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.server=server,$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"!=$scope.Usuario.rol&&"Almacenista"!=$scope.Usuario.rol||$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado",$scope.Empleado={},$scope.Empleado.rol=null;var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editar+BotonesTabla.Borrar+"</div>";$scope.gridOptions={columnDefs:[{field:"documento o nit",field:"documento",width:"20%",minWidth:160},{field:"nombre",width:"20%",minWidth:160},{field:"telefono",width:"15%",minWidth:160},{field:"cargo",width:"20%",minWidth:160},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla);var handleFileSelect=function(evt){angular.element(document.querySelector("#inputval")).text($(this).val());var file=evt.currentTarget.files[0],reader=new FileReader;reader.onload=function(evt){$scope.$apply(function($scope){$scope.contador=4,$scope.myImage=evt.target.result})},reader.readAsDataURL(file)};angular.element(document.querySelector("#fileInput")).on("change",handleFileSelect),$scope.cambiar=function(act){1==act&&$scope.contador<3?$scope.contador=1:2==act&&$scope.contador++,$scope.contador>=3&&($scope.cambio=!0)},$scope.EnviarEmpleado=function(){
switch($scope.preloader.estado=!0,$scope.Empleado.rol){case"super_administrador":$scope.Empleado.super_administrador=!0,$scope.Empleado.contador=!1,$scope.Empleado.almacenista=!1,$scope.Empleado.empleado=!1;break;case"contador":$scope.Empleado.contador=!0,$scope.Empleado.super_administrador=!1,$scope.Empleado.almacenista=!1,$scope.Empleado.empleado=!1;break;case"almacenista":$scope.Empleado.almacenista=!0,$scope.Empleado.contador=!1,$scope.Empleado.super_administrador=!1,$scope.Empleado.empleado=!1;break;case"empleado":$scope.Empleado.empleado=!0,$scope.Empleado.contador=!1,$scope.Empleado.super_administrador=!1,$scope.Empleado.almacenista=!1}var ruta="",metodo="";"Registro de Empleados"==$scope.panel_title_form?($scope.Empleado.myImage=$scope.myCroppedImage,$scope.Empleado.Image=$scope.myImage,ruta="personas",metodo="post"):($scope.cambio&&($scope.Empleado.myImage=$scope.myCroppedImage,$scope.Empleado.Image=$scope.myImage),ruta="personas/"+$scope.Empleado._id,metodo="put"),webServer.getResource(ruta,$scope.Empleado,metodo).then(function(data){"Registro de Empleados"==$scope.panel_title_form?($scope.Empleado._id=data.data.datos._id,$scope.Empleados.unshift($scope.Empleado)):$scope.Empleados[$scope.Empleado.index]=$scope.Empleado,$scope.Empleado={},$scope.myImage="",$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Empleados.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.super_administrador?$scope.Detalle.rol="Super Administrador":$scope.Detalle.contador?$scope.Detalle.rol="Contador":$scope.Detalle.almacenista?$scope.Detalle.rol="Almacenista":$scope.Detalle.empleado&&($scope.Detalle.rol="Empleado"),$("#modalDetalles").modal("open")},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar el empleado de la base de datos?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.Editar=function(id){$scope.Empleado=IdentificarPersona(id,$scope.Empleados),$scope.Empleado.super_administrador?$scope.Empleado.rol="super_administrador":$scope.Empleado.contador?$scope.Empleado.rol="contador":$scope.Empleado.almacenista?$scope.Empleado.rol="almacenista":$scope.Empleado.empleado&&($scope.Empleado.rol="empleado"),$scope.myImage=$scope.Empleado.myImage||"",$scope.panel_title_form="Edicion de Empleado",$scope.button_title_form="Actualizar Empleado",scroll()},$scope.CancelarEditar=function(){$scope.Empleado={},$scope.myImage="",$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado"},$scope.validarNumero=function(id){$scope.Empleado.telefono<0&&($scope.Empleado.telefono=0)},function(){$scope.preloader.estado=!0,webServer.getResource("personas",{empleado:!0,contador:!0,almacenista:!0,super_administrador:!0},"get").then(function(data){$scope.Empleados=data.data.datos,$scope.gridOptions.data=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Empleados=[],$scope.preloader.estado=!1})}()}]),angular.module("frontendApp").controller("OrdenVentaCtrl",["$scope","$state","$timeout","webServer","Tabla","BotonesTabla","preloader",function($scope,$state,$timeout,webServer,Tabla,BotonesTabla,preloader){function listarPersonas(){webServer.getResource("personas",{cliente:!0},"get").then(function(data){$scope.clientes=data.data.datos,listarProductos()},function(data){$scope.clientes=[],listarProductos()})}function listarProductos(){webServer.getResource("productos",{producto:!0,kit:!0},"get").then(function(data){data.data?$scope.productos=data.data.datos:$scope.productos=[],listarSalidas()},function(data){$scope.productos=[],listarSalidas()})}function listarSalidas(){webServer.getResource("salidas",{},"get").then(function(data){$scope.Salidas=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Salidas=[],$scope.preloader.estado=!1})}function Borrar(_id){webServer.getResource("orden_venta/"+_id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,index){ele._id==_id&&$scope.Ordenes.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarOrden(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,orden_venta_consecutivo:ele.orden_venta_consecutivo,cliente:ele.cliente,productos:ele.productos,observaciones:ele.observaciones,orden_compra_cliente:ele.orden_compra_cliente,fecha_recepcion:new Date(Date.parse(ele.fecha_recepcion)),fecha_entrega:new Date(Date.parse(ele.fecha_entrega)),lugar_entrega:ele.lugar_entrega,estado:ele.estado})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.estadoactivoorden="Activo",$scope.estadosalidasorden="Con Salidas",$scope.estadofinalizadoorden="Finalizado",$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="",$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta",$scope.noDisponible=[],$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.Producto={},$scope.Orden.Producto._id="";var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editarorden+BotonesTabla.Finalizar),"Almacenista"!=$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Factura),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{name:"No. de orden",field:"orden_venta_consecutivo",width:"10%",minWidth:100},{name:"cliente",field:"cliente.nombre",width:"15%",minWidth:150},{name:"Orden de cliente",field:"orden_compra_cliente",width:"12%",minWidth:100},{name:"fecha de solicitud",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha_recepcion)}}</div>",minWidth:150},{field:"estado",width:"13%",minWidth:100},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"35%",minWidth:420}]},angular.extend($scope.gridOptions,Tabla),$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[],$scope.materias=[],function(){$scope.preloader.estado=!0,webServer.getResource("orden_venta",{Salidas:!0,Finalizado:!0,Activo:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.gridOptions.data=$scope.Ordenes,listarPersonas()},function(data){$scope.Ordenes=[],$scope.gridOptions.data=$scope.Ordenes,listarPersonas()})}(),$scope.cargarProducto=function(keyEvent){$scope.productos.forEach(function(ele,index){$scope.Orden.Producto.codigo==ele.codigo&&($scope.Orden.Producto._id=ele._id+","+ele.nombre+","+ele.precio+","+(ele.fabricado||"")+","+ele.codigo+","+ele.tipo,13===keyEvent.which&&$("#Cantidad").focus())})},$scope.detectar=function(keyEvent){$scope.Orden.Producto.cantidad>0&&13===keyEvent.which&&""!=$scope.Orden.Producto._id&&$scope.AgregarProducto()},$scope.AgregarProducto=function(){if(""!=$scope.Orden.Producto._id&&$scope.Orden.Producto.cantidad>0){var controlador=!1,obj={_id:$scope.Orden.Producto._id.split(",")[0],nombre:$scope.Orden.Producto._id.split(",")[1],precio:parseInt($scope.Orden.Producto._id.split(",")[2]),fabricado:$scope.Orden.Producto._id.split(",")[3],codigo:$scope.Orden.Producto._id.split(",")[4],tipo:$scope.Orden.Producto._id.split(",")[5],cantidad:$scope.Orden.Producto.cantidad,cantidad_faltante:$scope.Orden.Producto.cantidad,cantidad_saliente:0};$scope.Orden.productos.forEach(function(ele,index){ele._id==obj._id&&(ele.cantidad+=parseInt(obj.cantidad),ele.cantidad_faltante+=parseInt(obj.cantidad),controlador=!0)}),controlador?Materialize.toast("La cantidad se ha sumado al producto ya añadido",4e3):$scope.Orden.productos.push(obj),$scope.Orden.Producto={},$scope.Orden.Producto._id="",$scope.Orden.Producto.cantidad=0,$("#codigo_barras").focus()}},$scope.Detalles=function(id){$scope.Detalle=$scope.Ordenes.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.productos||($scope.Detalle.productos=[]),$("#modaldeDetalles").modal("open")},$scope.BorrarProducto=function(index){$scope.Orden.productos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la orden de venta?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.EnviarOrden=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de venta"==$scope.panel_title_form?(ruta="orden_venta",metodo="post"):(ruta="orden_venta/"+$scope.Orden._id,metodo="put"),webServer.getResource(ruta,$scope.Orden,metodo).then(function(data){if($scope.clientes.forEach(function(ele,index){ele._id==$scope.Orden.cliente._id&&($scope.Orden.cliente=ele)}),"Registro de venta"==$scope.panel_title_form?($scope.Orden._id=data.data.datos._id,$scope.Orden.orden_venta_consecutivo=data.data.datos.orden_venta_consecutivo,$scope.Orden.estado="Activo",$scope.Ordenes.unshift($scope.Orden)):($scope.Ordenes[$scope.Orden.index]=$scope.Orden,$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta"),$scope.Orden={},$scope.Orden.productos=[],$scope.preloader.estado=!1,data.data.noDisponible.length>0){$scope.noDisponible=data.data.noDisponible;var mensaje="<ul>";$scope.noDisponible.forEach(function(ele,index){mensaje+="<li>"+ele+"</li>"}),mensaje+="</ul>",swal({title:"Atención",text:mensaje,type:"warning",html:!0})}else sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.Orden=IdentificarOrden(id,$scope.Ordenes),"Activo"==$scope.Orden.estado?($scope.panel_title_form="Edicion de Venta",$scope.button_title_form="Actualizar Venta",$scope.Orden.productos||($scope.Orden.productos=[]),scroll()):(sweetAlert("Oops...","La orden de venta no se puede editar porque ya cuenta con salidas","error"),$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[])},$scope.Finalizar=function(id){swal({title:"Confirmar Finalización",text:"¿Esta seguro de finalizar la orden de venta?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Finalizar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){webServer.getResource("orden_venta/finalizar/"+id,{},"put").then(function(data){$scope.Ordenes.forEach(function(ele,index){ele._id==id&&($scope.Ordenes[index]=data.data.datos)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})})},$scope.CancelarEditar=function(){$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[],$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta"},$scope.validarFechaEntrega=function(){$scope.Orden.fecha_entrega&&($scope.Orden.fecha_recepcion?$scope.Orden.fecha_entrega<$scope.Orden.fecha_recepcion&&(Materialize.toast("La fecha de entrega debe ser igual o posterior a la fecha de recepción",4e3),$scope.Orden.fecha_entrega=""):(Materialize.toast("Ingrese por favor una fecha de recepción primero",4e3),$scope.Orden.fecha_entrega="",$("#fecha_recepcion").focus()))},$scope.validarFechaRecepcion=function(){$scope.Orden.fecha_recepcion?$scope.Orden.fecha_entrega&&$scope.Orden.fecha_entrega<$scope.Orden.fecha_recepcion&&(Materialize.toast("La fecha de entrega debe ser igual o posterior a la fecha de recepción",4e3),$scope.Orden.fecha_entrega=""):$scope.Orden.fecha_entrega=""},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.Factura=function(param){$state.go("Factura",param)}}]),angular.module("frontendApp").controller("OrdenCompraCtrl",["$state","$scope","$timeout","webServer","Tabla","BotonesTabla","preloader",function($state,$scope,$timeout,webServer,Tabla,BotonesTabla,preloader){function Borrar(id){webServer.getResource("orden_compra/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,index){ele._id==id&&$scope.Ordenes.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarOrden(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,proveedor:ele.proveedor,orden_compra_consecutivo:ele.orden_compra_consecutivo,productos:ele.productos,materia_prima:ele.materia_prima,observaciones:ele.observaciones,fecha:ele.fecha,estado:ele.estado})}),obj}function listarPersonas(){webServer.getResource("personas",{proveedorproductos:!0},"get").then(function(data){$scope.proveedores=data.data.datos,listarEntradas()},function(data){$scope.proveedores=[],listarEntradas()})}function listarEntradas(){webServer.getResource("entradas",{},"get").then(function(data){$scope.Entradas=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Entradas=[],$scope.preloader.estado=!1})}function listarMaterias(){webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.materias=data.data.datos,listarPersonas()},function(data){$scope.materias=[],listarPersonas()})}function listarProductos(){webServer.getResource("productos",{producto:!0},"get").then(function(data){$scope.productos=data.data.datos,listarMaterias()},function(data){$scope.productos=[],listarMaterias()})}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.estadoactivoorden="Activo",$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"!=$scope.Usuario.rol&&"Almacenista"!=$scope.Usuario.rol||$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra",$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[],$scope.Orden.Producto={},$scope.Orden.Producto._id="";var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editarorden+BotonesTabla.Borrarorden+"</div>";$scope.gridOptions={columnDefs:[{name:"No. de orden",field:"orden_compra_consecutivo",width:"10%",minWidth:100},{name:"proveedor",field:"proveedor.nombre",width:"30%",minWidth:150},{name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:150},{field:"estado",width:"15%",minWidth:150},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:150}]},angular.extend($scope.gridOptions,Tabla),$scope.Detalles=function(id){$scope.Detalle=$scope.Ordenes.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.materia_prima||($scope.Detalle.materia_prima=[]),$scope.Detalle.productos||($scope.Detalle.productos=[]),$("#modalDetalles").modal("open")},$scope.cargarProducto=function(keyEvent){$scope.productos.forEach(function(ele,index){$scope.Orden.Producto.codigo==ele.codigo&&($scope.Orden.Producto._id=ele._id+","+ele.nombre,13===keyEvent.which&&$("#Cantidad-producto").focus())})},$scope.detectar=function(keyEvent){$scope.Orden.Producto.cantidad>0&&13===keyEvent.which&&""!=$scope.Orden.Producto._id&&$scope.AgregarProducto()},$scope.AgregarProducto=function(){if(""!=$scope.Orden.Producto._id&&$scope.Orden.Producto.cantidad>0){var controlador=!1,_id=$scope.Orden.Producto._id.split(",")[0],obj={};$scope.productos.forEach(function(ele,index){_id==ele._id&&(obj=ele)}),obj.cantidad=$scope.Orden.Producto.cantidad,obj.cantidad_faltante=$scope.Orden.Producto.cantidad,obj.cantidad_entrante=0,$scope.Orden.productos.forEach(function(ele,index){ele._id==obj._id&&(ele.cantidad+=parseInt(obj.cantidad),ele.cantidad_faltante+=parseInt(obj.cantidad),controlador=!0)}),controlador?Materialize.toast("La cantidad se ha sumado al producto ya añadido",4e3):$scope.Orden.productos.push(obj),$scope.Orden.Producto={},$scope.Orden.Producto._id="",$scope.Orden.Producto.cantidad=0,$("#codigo_barras").focus()}},$scope.AgregarMateria=function(){var controlador=!1,obj={},_id=$scope.Orden.Materia._id.split(",")[0];$scope.materias.forEach(function(ele,index){_id==ele._id&&(obj=ele)}),obj.cantidad=$scope.Orden.Materia.cantidad,obj.cantidad_faltante=$scope.Orden.Materia.cantidad,obj.cantidad_entrante=0,$scope.Orden.materia_prima.forEach(function(ele,index){ele._id==obj._id&&(ele.cantidad+=parseInt(obj.cantidad),ele.cantidad_faltante+=parseInt(obj.cantidad),controlador=!0)}),controlador?Materialize.toast("La cantidad se ha sumado al materia prima ya añadida",4e3):$scope.Orden.materia_prima.push(obj),$scope.Orden.Materia={}},$scope.BorrarMateria=function(index){$scope.Orden.materia_prima.splice(index,1)},$scope.BorrarProducto=function(index){$scope.Orden.productos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la orden de compra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.EnviarOrden=function(){$scope.preloader.estado=!0,$scope.Orden.productos.length<1&&($scope.Orden.productos=null),$scope.Orden.materia_prima.length<1&&($scope.Orden.materia_prima=null);var ruta="",metodo="";"Registro de Compra"==$scope.panel_title_form?(ruta="orden_compra",metodo="post"):(ruta="orden_compra/"+$scope.Orden._id,metodo="put"),webServer.getResource(ruta,$scope.Orden,metodo).then(function(data){$scope.proveedores.forEach(function(ele,index){ele._id==$scope.Orden.proveedor._id&&($scope.Orden.proveedor=ele)}),"Registro de Compra"==$scope.panel_title_form?($scope.Orden.estado="Activo",$scope.Orden.fecha=new Date(Date.now()),$scope.Orden._id=data.data.datos._id,$scope.Orden.orden_compra_consecutivo=data.data.datos.orden_compra_consecutivo,$scope.Ordenes.unshift($scope.Orden)):($scope.Ordenes[$scope.Orden.index]=$scope.Orden,$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra"),$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.Orden=IdentificarOrden(id,$scope.Ordenes),"Activo"==Orden.estado?($scope.panel_title_form="Edicion de Compra",$scope.button_title_form="Actualizar compra",$scope.Orden.productos||($scope.Orden.productos=[]),$scope.Orden.materia_prima||($scope.Orden.materia_prima=[]),scroll()):(sweetAlert("Oops...","No se puede editar la orden de compra porque ya posee entradas","error"),$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[])},$scope.CancelarEditar=function(){$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[],$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra"},$scope.validarNumeroMateria=function(id){$scope.Orden.Materia.cantidad<0&&($scope.Orden.Materia.cantidad=0)},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},function(){$scope.preloader.estado=!0,webServer.getResource("orden_compra",{Entradas:!0,Finalizado:!0,Activo:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.gridOptions.data=$scope.Ordenes,listarProductos()},function(data){$scope.Ordenes=[],$scope.gridOptions.data=$scope.Ordenes,listarProductos()})}()}]),angular.module("frontendApp").constant("BotonesTabla",{Detalles:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.Detalles(row.entity._id)">Detalles</a>',Editar:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.Editar(row.entity._id)">Editar</a>',Borrar:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',DetallesModal:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.DetallesModal(row.entity._id)">Detalles</a>',EditarModal:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.EditarModal(row.entity._id)">Editar</a>',BorrarModal:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.BorrarModal(row.entity._id)">Borrar</a>',Salida:'<a type="button" class="btn btn-tabla btn-info" ng-click="grid.appScope.Salida(row.entity._id)">Remision de salida</a>',Imprimir:'<a type="button" class="btn btn-tabla btn-primary" ng-click="grid.appScope.Imprimir(row.entity)">Imprimir Factura</a>',ImprimirRemision:'<a type="button" class="btn btn-tabla btn-primary" ng-click="grid.appScope.Imprimir(row.entity, 1)">Imprimir Remision</a>',ImprimirOrdenSalida:'<a type="button" class="btn btn-tabla btn-primary" ng-click="grid.appScope.Imprimir(row.entity, 2)">Imprimir Salida</a>',ImprimirOrdenTrabajo:'<a type="button" class="btn btn-tabla btn-primary" ng-click="grid.appScope.ImprimirTrabajo(row.entity)">Imprimir Orden</a>',Detalles:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.Detalles(row.entity._id)">Detalles</a>',Editar:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.Editar(row.entity._id)">Editar</a>',Borrar:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',DetallesModal:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.DetallesModal(row.entity._id)">Detalles</a>',EditarModal:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.EditarModal(row.entity._id)">Editar</a>',BorrarModal:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.BorrarModal(row.entity._id)">Borrar</a>',Salida:'<a type="button" class="btn btn-tabla btn-info" ng-click="grid.appScope.AbrirModalSalida(row.entity._id)">Remisión</a>',Entrada:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.AbrirModalEntrada(row.entity._id)">Entrada</a>',MateriaPrima:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.AbrirModalMateriaPrima(row.entity._id)">Materia Prima</a>',Factura:'<a type="button" class="btn btn-tabla btn-info" ng-show="row.entity.estado==grid.appScope.estadofinalizadoorden" ng-click="grid.appScope.Factura(row.entity)">Generar Factura</a>',Finalizar:'<a type="button" class="btn btn-tabla btn-primary" ng-show="row.entity.estado==grid.appScope.estadosalidasorden" ng-click="grid.appScope.Finalizar(row.entity._id)">Finalizar</a>',Borrarorden:'<a type="button" class="btn btn-tabla btn-danger" ng-show="row.entity.estado==grid.appScope.estadoactivoorden" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',Borrarfabricacion:'<a type="button" class="btn btn-tabla btn-danger" ng-show="row.entity.estado==grid.appScope.estadoactivofab" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',Editarorden:'<a type="button" class="btn btn-tabla btn-warning" ng-show="row.entity.estado==grid.appScope.estadoactivoorden" ng-click="grid.appScope.Editar(row.entity._id)">Editar</a>'}),angular.module("frontendApp").constant("Tabla",{enableSorting:!0,modifierKeysToMultiSelectCells:!0,enableFiltering:!0,paginationPageSizes:[10,20,30,40,50,100],paginationPageSize:10,enableColumnResizing:!0}),angular.module("frontendApp").controller("PerfilCtrl",["$scope","$timeout","SesionUsuario","webServer","preloader","server",function($scope,$timeout,SesionUsuario,webServer,preloader,server){function EnviarDatos(actualizo){JSON.stringify($scope.Usuario)!=JSON.stringify(SesionUsuario.ObtenerSesion())?($scope.preloader.estado=!0,webServer.getResource("personas/"+$scope.Usuario._id,$scope.Usuario,"put").then(function(data){SesionUsuario.ActualizarSesion($scope.Usuario),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})):(1==actualizo?(SesionUsuario.ActualizarSesion($scope.Usuario),$scope.preloader.estado=!1,$scope.Detallemodal.mensaje="Operación realizada con exito"):$scope.Detallemodal.mensaje="No hay ningun dato por actualizar",sweetAlert("Completado...",$scope.Detallemodal.mensaje,"success"))}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.panelAnimate="",$scope.pageAnimate="",$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.server=server,$scope.panel_title_form="Perfil",$scope.button_title_form="Actualizar datos",$scope.Usuario=SesionUsuario.ObtenerSesion(),$scope.myImage=$scope.Usuario.Image||"",$scope.MiUsuario={},$scope.Detallemodal={},$scope.cambio=!1,$scope.myCroppedImage="",$scope.contador=0;var handleFileSelect=function(evt){angular.element(document.querySelector("#inputval")).text($(this).val());var file=evt.currentTarget.files[0],reader=new FileReader;reader.onload=function(evt){$scope.$apply(function($scope){$scope.contador=4,$scope.myImage=evt.target.result})},reader.readAsDataURL(file)};angular.element(document.querySelector("#fileInput")).on("change",handleFileSelect),$scope.cambiar=function(act){1==act&&$scope.contador<3?$scope.contador=1:2==act&&$scope.contador++,$scope.contador>=3&&($scope.cambio=!0)},$scope.CambiarPss=function(){webServer.getResource("personas/"+$scope.Usuario._id,$scope.Pss,"put").then(function(data){$("#modalPss").modal("close"),$scope.Pss={},sweetAlert("Completado...","La contraseña se ha actualizado satisfactoriamente","success")},function(data){sweetAlert("Oops...",data.data.message,"error")})},$scope.ImageUpdate=function(){$scope.cambio?($scope.preloader.estado=!0,$scope.MiUsuario.myImage=$scope.myCroppedImage,$scope.MiUsuario.Image=$scope.myImage,$scope.Usuario.Image=$scope.myImage,webServer.getResource("personas/"+$scope.Usuario._id,$scope.MiUsuario,"put").then(function(data){var imagen=document.getElementsByClassName("circle"),atributo=imagen[0].getAttribute("src"),src="";atributo==$scope.server+"/imagen/"+$scope.Usuario._id?src=$scope.server+"/imagen1/"+$scope.Usuario._id:atributo==$scope.server+"/imagen1/"+$scope.Usuario._id&&(src=$scope.server+"/imagen/"+$scope.Usuario._id),imagen[0].setAttribute("src",src),EnviarDatos(1)},function(data){})):EnviarDatos(0)}}]),angular.module("frontendApp").controller("MateriaPrimaCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function scroll(){$("html, body").animate({scrollTop:0},1e3)}function Borrar(id){webServer.getResource("materiaPrima/"+id,{},"delete").then(function(data){$scope.Materias.forEach(function(ele,index){ele._id==id&&$scope.Materias.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function IdentificarMateria(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,nombre:ele.nombre,marca:ele.marca,unidad_medida:ele.unidad_medida,min_stock:ele.min_stock,cantidad:ele.cantidad,materia_consecutivo:ele.materia_consecutivo})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima",$scope.Materia={},$scope.Materia.unidad_medida={};var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editar+BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{field:"nombre",width:"30%",minWidth:160},{field:"min_stock",width:"20%",minWidth:160},{name:"cantidad",width:"20%",cellTemplate:"<div>{{row.entity.cantidad}} {{row.entity.unidad_medida.nombre}}</div>",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.EnviarMateria=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Materia Prima"==$scope.panel_title_form?(ruta="materiaPrima",metodo="post"):(ruta="materiaPrima/"+$scope.Materia._id,metodo="put"),webServer.getResource(ruta,$scope.Materia,metodo).then(function(data){$scope.Unidades.forEach(function(ele,index){ele._id==$scope.Materia.unidad_medida._id&&($scope.Materia.unidad_medida=ele)}),"Registro de Materia Prima"==$scope.panel_title_form?($scope.Materia._id=data.data.datos._id,$scope.Materias.unshift($scope.Materia)):($scope.Materias[$scope.Materia.index]=$scope.Materia,$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima"),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success"),$scope.Materia={}},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Materias.find(function(ele){if(ele._id==id)return ele}),$("#modalDetalles").modal("open")},$scope.Editar=function(id){$scope.Materia=IdentificarMateria(id,$scope.Materias),$scope.panel_title_form="Edicion de Materia Prima",$scope.button_title_form="Actualizar Materia Prima",scroll()},$scope.CancelarEditar=function(){$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima",$scope.Materia={}},$scope.validarNumeroMinStock=function(id){$scope.Materia.min_stock<1&&($scope.Materia.min_stock=1)},$scope.validarNumero=function(id){$scope.Materia.cantidad<1&&($scope.Materia.cantidad=1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la materia prima?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},function(){$scope.preloader.estado=!0,webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.Materias=data.data.datos,$scope.gridOptions.data=$scope.Materias,$scope.preloader.estado=!1},function(data){$scope.Materias=[],$scope.gridOptions.data=$scope.Materias,$scope.preloader.estado=!1})}()}]),angular.module("frontendApp").controller("RestaurarCtrl",["$scope","webServer","$state","preloader",function($scope,webServer,$state,preloader){$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.Enviar=function(){$scope.preloader.estado=!0,webServer.getResource("personas/contrasena/",$scope.Usuario,"put").then(function(data){
$scope.Usuario={},$scope.preloader.estado=!1,sweetAlert("Completado...","Su contraseña ha sido enviada a su correo","success"),$state.go("InicioSesion")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}}]),angular.module("frontendApp").controller("EntradaCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function Borrar(id){webServer.getResource("entradas/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,ind){ele._id==data.data.datos.orden_compra._id&&($scope.Ordenes[ind]=data.data.datos.orden_compra)}),$scope.Entradas.forEach(function(ele,index){ele._id==id&&$scope.Entradas.splice(index,1)}),swal("Completado...",data.data.message,"success")},function(data){swal("Oops...",data.data.message,"error")})}function listarOrdenes(){webServer.getResource("orden_compra",{Activo:!0,Entradas:!0,Finalizado:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Ordenes=[],$scope.preloader.estado=!1})}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Entradas",$scope.button_title_form="Registrar Entrada",$scope.Entrada={},$scope.Entrada.orden_compra=[],$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[];var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{name:"No. entrada",field:"entrada_consecutivo",width:"15%",minWidth:100},{name:"orden de compra",field:"orden_compra.orden_compra_consecutivo",width:"15%",minWidth:100},{name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:100},{name:"proveedor",field:"orden_compra.proveedor.nombre",width:"30%",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.CancelarEditar=function(){$scope.Entrada={},$scope.Entrada.orden_compra={},$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[],$scope.Orden.compra=""},$scope.CargarOrden=function(){$scope.Ordenes.forEach(function(ele,index){ele._id==$scope.Orden.compra&&($scope.Entrada.orden_compra=ele)}),$scope.Entrada.orden_compra.productos||($scope.Entrada.orden_compra.productos=[]),$scope.Entrada.orden_compra.materia_prima||($scope.Entrada.orden_compra.materia_prima=[])},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la entrada?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){Borrar(_id)})},$scope.EnviarEntrada=function(){$scope.preloader.estado=!0,$scope.Entrada.orden_compra.productos&&$scope.Entrada.orden_compra.productos.forEach(function(ele,index){ele.cantidad_faltante>0?ele.cantidad_entrante=angular.element("#cantidad"+ele._id).val():ele.cantidad_entrante=0}),$scope.Entrada.orden_compra.materia_prima&&$scope.Entrada.orden_compra.materia_prima.forEach(function(ele,index){ele.cantidad_faltante>0?ele.cantidad_entrante=angular.element("#cantidad"+ele._id).val():ele.cantidad_entrante=0}),$scope.Entrada.estado="Activo",webServer.getResource("entradas",$scope.Entrada,"post").then(function(data){$scope.Entrada.fecha=new Date(Date.now()),$scope.Entrada._id=data.data.datos._id,$scope.Entrada.entrada_consecutivo=data.data.datos.entrada_consecutivo,$scope.Entradas.unshift($scope.Entrada),$scope.Ordenes.forEach(function(ele,ind){ele._id==$scope.Entrada.orden_compra._id&&($scope.Ordenes[ind]=data.data.datos.orden_compra)}),$scope.Entrada={},$scope.Entrada.orden_compra={},$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[],$scope.Orden.compra="",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Entradas.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.orden_compra.materia_prima||($scope.Detalle.orden_compra.materia_prima=[]),$scope.Detalle.orden_compra.productos||($scope.Detalle.orden_compra.productos=[]),$("#modaldeDetalles").modal("open")},function(){$scope.preloader.estado=!0,webServer.getResource("Entradas",{},"get").then(function(data){$scope.Entradas=data.data.datos,$scope.gridOptions.data=$scope.Entradas,listarOrdenes()},function(data){$scope.Entradas=[],$scope.gridOptions.data=$scope.Entradas,listarOrdenes()})}()}]);