"use strict";angular.module("frontendApp",["ui.router","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngSanitize","ngTouch","LocalStorageModule","perfect_scrollbar","ui.grid","ui.grid.autoResize","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.pagination","ui.grid.cellNav","mdo-angular-cryptography","uiCropper","ui.materialize","io-barcode"]).config(["localStorageServiceProvider",function(localStorageServiceProvider){localStorageServiceProvider.setPrefix("inventoryPrinesApp").setStorageType("sessionStorage").setNotify(!0,!0)}]).config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/Login/InicioSesion"),$stateProvider.state("plain",{abstract:!0,url:"",templateUrl:"views/layouts/plain.html"}).state("Login",{url:"/Login",parent:"plain",templateUrl:"views/layouts/login.html",controller:"LoginCtrl"}).state("Restaurar",{url:"/Restaurar",parent:"Login",templateUrl:"views/pages/restaurar.html",controller:"RestaurarCtrl"}).state("InicioSesion",{url:"/InicioSesion",parent:"Login",templateUrl:"views/pages/inicio_sesion.html",controller:"IniciosesionCtrl"}).state("Home",{url:"/Home",parent:"Dashboard",templateUrl:"views/pages/home.html",controller:"HomeCtrl"}).state("Dashboard",{url:"/Dashboard",parent:"plain",templateUrl:"views/layouts/dashboard.html",controller:"DashboardCtrl"}).state("Perfil",{url:"/Perfil",parent:"Dashboard",templateUrl:"views/pages/perfil.html",controller:"PerfilCtrl"}).state("Entrada",{url:"/Entrada",parent:"Dashboard",templateUrl:"views/pages/entrada.html",controller:"EntradaCtrl"}).state("Salida",{url:"/Salida",parent:"Dashboard",templateUrl:"views/pages/salida.html",controller:"SalidaCtrl"}).state("Personas",{url:"/Personas",parent:"Dashboard",templateUrl:"views/pages/personas.html",controller:"PersonasCtrl"}).state("Productos",{url:"/Productos",parent:"Dashboard",templateUrl:"views/pages/productos.html",controller:"ProductosCtrl"}).state("Empleados",{url:"/Empleados",parent:"Dashboard",templateUrl:"views/pages/empleados.html",controller:"EmpleadosCtrl"}).state("Fabricacion",{url:"/Fabricacion",parent:"Dashboard",templateUrl:"views/pages/fabricacion.html",controller:"FabricacionCtrl"}).state("OrdenVenta",{url:"/OrdenVenta",parent:"Dashboard",templateUrl:"views/pages/orden_venta.html",controller:"OrdenVentaCtrl"}).state("OrdenCompra",{url:"/OrdenCompra",parent:"Dashboard",templateUrl:"views/pages/orden_compra.html",controller:"OrdenCompraCtrl"}).state("MateriaPrima",{url:"/MateriaPrima",parent:"Dashboard",templateUrl:"views/pages/materia_prima.html",controller:"MateriaPrimaCtrl"}).state("Factura",{url:"/Factura/:_id",parent:"Dashboard",templateUrl:"views/pages/factura.html",controller:"FacturaCtrl"})}]),angular.module("frontendApp").controller("IniciosesionCtrl",["$scope","webServer","SesionUsuario","$state","preloader",function($scope,webServer,SesionUsuario,$state,preloader){$scope.preloader=preloader,$scope.preloader.estado=!1,null!=SesionUsuario.ObtenerSesion()&&$state.go("Home"),$scope.userLogin={},$scope.login=function(){$scope.preloader.estado=!0,webServer.getResource("personas/login",$scope.userLogin,"post").then(function(data){$scope.preloader.estado=!1,SesionUsuario.CrearSesion(data.data.datos)&&$state.go("Home")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}}]),angular.module("frontendApp").service("webServer",["$http",function($http){return{getResource:function(resource,data,metodo){var URL="http://inventory:5000/"+resource;if(void 0==data&&(data={}),"get"==metodo){var req={method:"GET",url:URL,params:data};return $http(req)}if("post"==metodo){var req={method:"POST",url:URL,data:data};return $http(req)}return"put"==metodo?$http.put(URL,data):"delete"==metodo?$http.delete(URL,data):void 0}}}]),angular.module("frontendApp").service("SesionUsuario",["localStorageService",function(localStorageService){return{CrearSesion:function(user){return user.super_administrador?user.rol="Super Administrador":user.contador?user.rol="Contador":user.almacenista?user.rol="Almacenista":user.empleado&&(user.rol="Empleado"),localStorageService.set("Usuario",user),!0},ObtenerSesion:function(){return localStorageService.get("Usuario")},CerrarSesion:function(){return localStorageService.remove("Usuario")},ActualizarSesion:function(user){localStorageService.set("Usuario",user)}}}]),angular.module("frontendApp").controller("HomeCtrl",function(){}),angular.module("frontendApp").directive("sidenavb",function(){return{templateUrl:"views/directives/sidenav.html",restrict:"E",link:function(scope,element,attrs){},controller:"DashboardCtrl"}}),angular.module("frontendApp").directive("topnav",function(){return{templateUrl:"views/directives/topnav.html",restrict:"E",link:function(scope,element,attrs){},controller:"DashboardCtrl"}}),angular.module("frontendApp").controller("DashboardCtrl",["$scope","$state","SesionUsuario","webServer","Tabla","BotonesTabla","preloader",function($scope,$state,SesionUsuario,webServer,Tabla,BotonesTabla,preloader){function listarCategorias(){webServer.getResource("categorias",{},"get").then(function(data){$scope.Categorias=data.data.datos,$scope.gridOptionsModalCategorias.data=$scope.Categorias,listarProcesos()},function(data){$scope.Categorias=[],$scope.gridOptionsModalCategorias.data=$scope.Categorias,listarProcesos()})}function listarProcesos(){webServer.getResource("procesos",{},"get").then(function(data){$scope.Procesos=data.data.datos,$scope.gridOptionsModalProcesos.data=$scope.Procesos,$scope.preloader.estado=!1},function(data){$scope.Procesos=[],$scope.gridOptionsModalProcesos.data=$scope.Procesos,$scope.preloader.estado=!1})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}if($(document).ready(function(){$(".modal").modal(),$("#modal1").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!0,$scope.categorias=!1,$scope.procesos=!1},complete:function(){}}),$("#modal2").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!1,$scope.categorias=!0,$scope.procesos=!1},complete:function(){}}),$("#modal3").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){$scope.unidades=!1,$scope.categorias=!1,$scope.procesos=!0},complete:function(){}})}),$scope.preloader=preloader,$scope.$state=$state,$scope.categoria={},null==SesionUsuario.ObtenerSesion())$state.go("InicioSesion");else{$scope.Usuario=SesionUsuario.ObtenerSesion(),$scope.NombreDeUsuario="";for(var i=0,contador=0;0==i;)if(contador<$scope.Usuario.nombre.length){var caracter=$scope.Usuario.nombre.charAt(contador);" "==caracter?i=1:$scope.NombreDeUsuario+=caracter,contador++}else i=1;if($scope.Usuario.apellidos)for($scope.NombreDeUsuario+=" ",i=0,contador=0;0==i;)if(contador<$scope.Usuario.apellidos.length){var caracter=$scope.Usuario.apellidos.charAt(contador);" "==caracter?i=1:$scope.NombreDeUsuario+=caracter,contador++}else i=1}$scope.TituloPanelCategorias="Registro de Categorias",$scope.TituloBotonCategorias="Registrar Categoria";var casillaDeBotonesModalCategorias="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalCategorias={columnDefs:[{field:"nombre",width:"30%",minWidth:200},{field:"codigo",width:"30%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalCategorias,width:"40%",minWidth:200}]},angular.extend($scope.gridOptionsModalCategorias,Tabla),$scope.TituloPanelUnidades="Registro de Unidades de Medida",$scope.TituloBotonUnidades="Registrar Unidad de Medida";var casillaDeBotonesModalUnidades="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalUnidades={columnDefs:[{field:"nombre",width:"50%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalUnidades,width:"50%",minWidth:200}]},angular.extend($scope.gridOptionsModalUnidades,Tabla),$scope.TituloPanelProcesos="Registro de procesos de fabricación",$scope.TituloBotonProcesos="Registrar Proceso";var casillaDeBotonesModalProcesos="<div>"+BotonesTabla.EditarModal+"</div>";$scope.gridOptionsModalProcesos={columnDefs:[{field:"nombre",width:"33%",minWidth:200},{field:"interno o externo",cellTemplate:"<div> Proceso {{row.entity.tipo}}</div>",width:"33%",minWidth:200},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotonesModalProcesos,width:"34%",minWidth:200}]},angular.extend($scope.gridOptionsModalProcesos,Tabla),$scope.EnviarUnidad=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Unidades de Medida"==$scope.TituloPanelUnidades?(ruta="unidades",metodo="post"):(ruta="unidades/"+$scope.Unidad_de_medida._id,metodo="put"),webServer.getResource(ruta,$scope.Unidad_de_medida,metodo).then(function(data){"Registro de Unidades de Medida"==$scope.TituloPanelUnidades?($scope.Unidad_de_medida._id=data.data.datos._id,$scope.Unidades.push($scope.Unidad_de_medida)):$scope.Unidades[$scope.Unidad_de_medida.index]=$scope.Unidad_de_medida,$scope.Unidad_de_medida={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},function(){$scope.preloader.estado=!0,webServer.getResource("unidades",{},"get").then(function(data){$scope.Unidades=data.data.datos,$scope.gridOptionsModalUnidades.data=$scope.Unidades,listarCategorias()},function(data){$scope.Unidades=[],$scope.gridOptionsModalUnidades.data=$scope.Unidades,listarCategorias()})}(),$scope.EnviarCategoria=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Categorias"==$scope.TituloPanelCategorias?(ruta="categorias",metodo="post"):(ruta="categorias/"+$scope.categoria._id,metodo="put"),webServer.getResource(ruta,$scope.categoria,metodo).then(function(data){"Registro de Categorias"==$scope.TituloPanelCategorias?($scope.categoria._id=data.data.datos._id,$scope.categoria.codigo=data.data.datos.codigo,$scope.Categorias.push($scope.categoria)):$scope.Categorias[$scope.categoria.index]=$scope.categoria,$scope.categoria={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.EditarModal=function(_id){$scope.categorias?($scope.Categorias.forEach(function(ele,index){ele._id==_id&&($scope.categoria=ele)}),$scope.TituloPanelCategorias="Edición de Categorias",$scope.TituloBotonCategorias="Editar Categoria"):$scope.unidades?($scope.Unidades.forEach(function(ele,index){ele._id==_id&&($scope.Unidad_de_medida=ele)}),$scope.TituloPanelUnidades="Edición de Unidades de Medida",$scope.TituloBotonUnidades="Editar Unidad de Medida"):$scope.procesos&&($scope.Procesos.forEach(function(ele,index){ele._id==_id&&($scope.proceso=ele)}),$scope.TituloPanelProcesos="Edición de Procesos",$scope.TituloBotonProcesos="Editar Proceso")},$scope.Cancelar=function(){$scope.categorias?($scope.TituloPanelCategorias="Registro de Categorias",$scope.TituloBotonCategorias="Registrar Categoria",$scope.categoria={}):$scope.unidades?($scope.TituloPanelUnidades="Registro de Unidades de Medida",$scope.TituloBotonUnidades="Registrar Unidad de Medida",$scope.Unidad_de_medida={}):$scope.procesos&&($scope.TituloPanelProcesos="Registro de procesos de fabricación",$scope.TituloBotonProcesos="Registrar Proceso",$scope.proceso={})},$scope.EnviarProceso=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de procesos de fabricación"==$scope.TituloPanelProcesos?(ruta="procesos",metodo="post"):(ruta="procesos/"+$scope.proceso._id,metodo="put"),webServer.getResource(ruta,$scope.proceso,metodo).then(function(data){"Registro de procesos de fabricación"==$scope.TituloPanelProcesos?($scope.proceso._id=data.data.datos._id,$scope.Procesos.push($scope.proceso)):$scope.Procesos[$scope.proceso.index]=$scope.proceso,$scope.proceso={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.sidenav=function(){angular.element(".sidenav").toggleClass("sidenav-hidden"),angular.element(".top-nav").toggleClass("top-nav-hidden"),angular.element(".titulo-pagina").toggleClass("titulo-pagina-hidden"),angular.element(".perfil").toggleClass("perfil-hidden"),angular.element(".main-view").toggleClass("main-view-full"),angular.element(".side-nav>ul>li").click(function(event){screen.width<=600&&(angular.element(".sidenav").addClass("sidenav-hidden"),angular.element(".top-nav").addClass("top-nav-hidden"),angular.element(".perfil").addClass("perfil-hidden"),angular.element(".main-view").addClass("main-view-full"))})},$scope.active=!0,$scope.cerrarSesion=function(){SesionUsuario.CerrarSesion(),$state.go("InicioSesion")},angular.element(".side-nav>ul>li").click(function(){scroll()})}]),angular.module("frontendApp").controller("ProductosCtrl",["$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function listarInsumos(){webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.Insumos=data.data.datos,listarProductosSelect()},function(data){$scope.Insumos=[],console.log(data.data.message),listarProductosSelect()})}function listarProductosSelect(){webServer.getResource("productos",{producto:!0},"get").then(function(data){$scope.ProductosSelect=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.ProductosSelect=[],console.log(data.data.message),$scope.preloader.estado=!1})}function Borrar(id){$scope.preloader.estado=!0,webServer.getResource("productos/"+id,{},"delete").then(function(data){$scope.Productos.forEach(function(ele,index){ele._id==id&&$scope.Productos.splice(ele.index,1)}),$scope.ProductosSelect.forEach(function(ele,index){ele._id==id&&$scope.ProductosSelect.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarProducto(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,nombre:ele.nombre,min_stock:ele.min_stock,cantidad:ele.cantidad,marca:ele.marca,categoria:ele.categoria,tipo:ele.tipo,unidad_medida:ele.unidad_medida,Insumos:ele.Insumos,procesos:ele.procesos,productos:ele.productos,precio:ele.precio,fabricado:ele.fabricado,comprado:ele.comprado})}),obj}$scope.productBarCode=[],$scope.bc={lineColor:"#000000",height:50,displayValue:!0,fontSize:10},$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.panelAnimate="",$scope.pageAnimate="",$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto",$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.check="producto";var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editar+BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{field:"codigo",width:"15%",minWidth:160},{field:"nombre",width:"15%",minWidth:160},{field:"marca",width:"15%",minWidth:160},{name:"categoria",field:"categoria.nombre",width:"15%",minWidth:160},{name:"cantidad",width:"20%",cellTemplate:"<div>{{row.entity.cantidad}} {{row.entity.unidad_medida.nombre}}</div>",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),function(){$scope.preloader.estado=!0,webServer.getResource("productos",{producto:!0,kit:!0},"get").then(function(data){data.data?($scope.Productos=data.data.datos,$scope.gridOptions.data=$scope.Productos):($scope.Productos=[],$scope.gridOptions.data=$scope.Productos),listarInsumos()},function(data){$scope.Productos=[],$scope.gridOptions.data=$scope.Productos,console.log(data.data.message),listarInsumos()})}(),$scope.cargarProducto=function(){var conter=!0;$scope.Productos.forEach(function(ele,index){$scope.Kit.codigo==ele.codigo&&($scope.Kit.producto._id=ele._id+","+ele.nombre,conter=!1)}),conter&&($scope.Kit.producto={},$scope.Kit.producto._id="")},$scope.AgregarInsumo=function(){var controlador=!1,obj={_id:$scope.producto.Insumo._id.split(",")[0],nombre:$scope.producto.Insumo._id.split(",")[1],cantidad:$scope.producto.Insumo.cantidad};$scope.Producto.Insumos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El insumo ya esta añadido",4e3):$scope.Producto.Insumos.push(obj),$scope.producto={}},$scope.AgregarProceso=function(){var controlador=!1,obj={_id:$scope.proceso._id.split(",")[0],nombre:$scope.proceso._id.split(",")[1],tipo:$scope.proceso._id.split(",")[2]};$scope.Producto.procesos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El proceso ya esta añadido",4e3):$scope.Producto.procesos.push(obj),$scope.proceso={}},$scope.Borrarproceso=function(index){$scope.Producto.procesos.splice(index,1)},$scope.Borrarproducto=function(index){$scope.Producto.Insumos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar el producto?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","El producto no se borrará","error")})},$scope.Agregarkit=function(){var controlador=!1,obj={_id:$scope.Kit.producto._id.split(",")[0],nombre:$scope.Kit.producto._id.split(",")[1],cantidad:$scope.Kit.producto.cantidad};$scope.Producto.productos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El producto ya esta añadido",4e3):$scope.Producto.productos.push(obj),$scope.Kit={}},$scope.Borrarkit=function(index){$scope.Producto.productos.splice(index,1)},$scope.cambiar=function(){$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.Kit={},$scope.Kit.producto={}},$scope.EnviarProducto=function(){$scope.preloader.estado=!0;var ruta="",metodo="";$scope.Categorias.forEach(function(ele,index){$scope.Producto.categoria._id==ele._id&&($scope.Producto.categoria=ele)}),"kit"==$scope.check?($scope.Producto.Insumos=null,$scope.Producto.tipo="kit"):($scope.Producto.tipo="producto",$scope.Unidades.forEach(function(ele,index){ele._id==$scope.Producto.unidad_medida._id&&($scope.Producto.unidad_medida=ele)})),"Registro de Productos"==$scope.panel_title_form?(ruta="productos",metodo="post"):(ruta="productos/"+$scope.Producto._id,metodo="put"),webServer.getResource(ruta,$scope.Producto,metodo).then(function(data){"Registro de Productos"==$scope.panel_title_form?($scope.Producto._id=data.data.datos._id,$scope.Producto.producto_consecutivo=data.data.datos.producto_consecutivo,"producto"==$scope.check&&($scope.Producto.codigo=data.data.datos.codigo,$scope.ProductosSelect.push($scope.Producto)),$scope.Productos.push($scope.Producto)):($scope.Productos[$scope.Producto.index]=$scope.Producto,"producto"==$scope.check&&$scope.ProductosSelect.forEach(function(ele,index){ele._id==$scope.Producto._id&&($scope.ProductosSelect[$scope.Producto.index]=$scope.Producto)}),$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto"),$scope.Producto={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.check="producto",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.panel_title_form="Edicion de Producto",$scope.button_title_form="Actualizar Producto",$scope.Producto=IdentificarProducto(id,$scope.Productos),"kit"==$scope.Producto.tipo?$scope.check="kit":$scope.check="producto",console.log($scope.Producto),scroll()},$scope.Detalles=function(id){$scope.Detalle=$scope.Productos.find(function(ele){if(ele._id==id)return ele}),$("#modalDetalles").modal("open")},$scope.CancelarEditar=function(){$scope.Producto={},$scope.Producto.unidad_medida={},$scope.Producto.categoria={},$scope.Producto.Insumos=[],$scope.Producto.productos=[],$scope.Producto.procesos=[],$scope.Kit={},$scope.Kit.producto={},$scope.panel_title_form="Registro de Productos",$scope.button_title_form="Registrar Producto"},$scope.openModalBarCode=function(){$("#modalBarCode").modal("open")},$scope.addProductBarCode=function(){var pro=JSON.parse($scope.productBarCodeId),bandera=!0;if($scope.productBarCode.forEach(function(ele){if(ele.producto._id==pro._id)return bandera=!1}),bandera){pro.barcodes=[];for(var i=0;i<$scope.productBarCodeCant;i++)pro.barcodes.push({code:pro.codigo});$scope.productBarCode.push({producto:pro,cantidad:$scope.productBarCodeCant})}$scope.productBarCodeCant=null,$scope.productBarCodeId=null},$scope.printBarCodes=function(){var container=document.getElementById("containerBarCodesToPrint"),newWindow=window.open();newWindow.document.open(),newWindow.document.appendChild(container),newWindow.print(),newWindow.close(),document.getElementById("superContainer").appendChild(container),$scope.productBarCode=[]}}]),angular.module("frontendApp").controller("PersonasCtrl",["$state","$scope","$timeout","webServer","Tabla","BotonesTabla","preloader",function($state,$scope,$timeout,webServer,Tabla,BotonesTabla,preloader){function Borrar(id){$scope.preloader.estado=!0,webServer.getResource("orden_venta/"+id,{},"delete").then(function(data){$scope.Personas.forEach(function(ele,index){ele._id==id&&$scope.Personas.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function listarCiudades(){webServer.getResource("ciudades",{},"get").then(function(data){$scope.Ciudades=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Ciudades=[],console.log(data.data),$scope.preloader.estado=!1})}function listarDepartamentos(){webServer.getResource("departamentos",{},"get").then(function(data){data.data.datos?($scope.Departamentos=data.data.datos,$scope.Persona.departamento=$scope.Departamentos[0]._id):$scope.Departamentos=[],listarCiudades()},function(data){$scope.Departamentos=[],console.log(data.data),listarCiudades()})}function IdentificarPersona(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,documento:ele.documento,nombre:ele.nombre,apellidos:ele.apellidos,direccion:ele.direccion,telefono:ele.telefono,correo:ele.correo,proveedor:ele.proveedor,proveedorfabricacion:ele.proveedorfabricacion,proveedorproductos:ele.proveedorproductos,cliente:ele.cliente,ciudad:ele.ciudad,contacto:ele.contacto,fax:ele.fax})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"!=$scope.Usuario.rol&&"Almacenista"!=$scope.Usuario.rol||$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona",$scope.Persona={},$scope.Persona.proveedor=!1;var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editar+BotonesTabla.Borrar+"</div>";$scope.gridOptions={columnDefs:[{name:"documento o nit",field:"documento",width:"20%",minWidth:160},{field:"nombre",width:"20%",minWidth:160},{field:"telefono",width:"20%",minWidth:160},{field:"contacto",width:"20%",minWidth:160},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"20%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.EnviarPersona=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de clientes y proveedores"==$scope.panel_title_form?(ruta="personas",metodo="post"):(ruta="personas/"+$scope.Persona._id,metodo="put"),$scope.Persona.proveedor||($scope.Persona.proveedorproductos=!1,$scope.Persona.proveedorfabricacion=!1),webServer.getResource(ruta,$scope.Persona,metodo).then(function(data){"Registro de clientes y proveedores"==$scope.panel_title_form?($scope.Persona._id=data.data.datos._id,$scope.Personas.push($scope.Persona)):$scope.Personas[$scope.Persona.index]=$scope.Persona,$scope.Persona={},$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),console.log(data)})},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar esta persona?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La persona no se borrará","error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Personas.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.rol="",$scope.Detalle.cliente&&($scope.Detalle.rol="Cliente"),$scope.Detalle.proveedor&&(""!=$scope.Detalle.rol&&($scope.Detalle.rol+=", "),$scope.Detalle.rol+="Proveedor"),$scope.Detalle.rol+=".",$("#modalDetalles").modal("open")},$scope.Editar=function(id){$scope.panel_title_form="Edicion de clientes y proveedores",$scope.button_title_form="Actualizar Persona",$scope.Persona=IdentificarPersona(id,$scope.Personas),scroll(),console.log($scope.Persona),$scope.Persona.ciudad&&($scope.Persona.departamento=$scope.Persona.ciudad.departamento._id)},$scope.CancelarEditar=function(){$scope.Persona={},$scope.Persona.proveedor=!1,$scope.panel_title_form="Registro de clientes y proveedores",$scope.button_title_form="Registrar Persona"},function(){$scope.preloader.estado=!0,webServer.getResource("personas",{proveedor:!0,cliente:!0},"get").then(function(data){$scope.Personas=data.data.datos,$scope.gridOptions.data=data.data.datos,listarDepartamentos()},function(data){$scope.Personas=[],console.log(data),listarDepartamentos()})}()}]),angular.module("frontendApp").controller("EmpleadosCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function Borrar(id){$scope.preloader.estado=!0,webServer.getResource("empleados/"+id,{},"delete").then(function(data){$scope.Empleados.forEach(function(ele,index){ele._id==id&&$scope.Empleados.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),console.log(data.data.message)})}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarPersona(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,documento:ele.documento,nombre:ele.nombre,apellidos:ele.apellidos,direccion:ele.direccion,telefono:ele.telefono,correo:ele.correo,super_administrador:ele.super_administrador,almacenista:ele.almacenista,contador:ele.contador,empleado:ele.empleado,cargo:ele.cargo})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"!=$scope.Usuario.rol&&"Almacenista"!=$scope.Usuario.rol||$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado",$scope.Empleado={},$scope.Empleado.rol=null;var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editar+BotonesTabla.Borrar+"</div>";$scope.gridOptions={columnDefs:[{field:"documento o nit",field:"documento",width:"20%",minWidth:160},{field:"nombre",width:"20%",minWidth:160},{field:"telefono",width:"15%",minWidth:160},{field:"cargo",width:"20%",minWidth:160},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.EnviarEmpleado=function(){switch($scope.preloader.estado=!0,$scope.Empleado.rol){case"super_administrador":$scope.Empleado.super_administrador=!0;break;case"contador":$scope.Empleado.contador=!0;break;case"almacenista":$scope.Empleado.almacenista=!0;break;case"empleado":$scope.Empleado.empleado=!0}var ruta="",metodo="";"Registro de Empleados"==$scope.panel_title_form?(ruta="personas",metodo="post"):(ruta="personas/"+$scope.Empleado._id,metodo="put"),webServer.getResource(ruta,$scope.Empleado,metodo).then(function(data){"Registro de Empleados"==$scope.panel_title_form?($scope.Empleado._id=data.data.datos._id,$scope.Empleados.push($scope.Empleado)):$scope.Empleados[$scope.Empleado.index]=$scope.Empleado,$scope.Empleado={},$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Empleados.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.super_administrador?$scope.Detalle.rol="Super Administrador":$scope.Detalle.contador?$scope.Detalle.rol="Contador":$scope.Detalle.almacenista?$scope.Detalle.rol="Almacenista":$scope.Detalle.empleado&&($scope.Detalle.rol="<E></E>mpleado"),$("#modalDetalles").modal("open")},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar el empleado de la base de datos?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","El empleado no se borrará","error")})},$scope.Editar=function(id){$scope.Empleado=IdentificarPersona(id,$scope.Empleados),$scope.Empleado.super_administrador?$scope.Empleado.rol="super_administrador":$scope.Empleado.contador?$scope.Empleado.rol="contador":$scope.Empleado.almacenista?$scope.Empleado.rol="almacenista":$scope.Empleado.empleado&&($scope.Empleado.rol="empleado"),$scope.panel_title_form="Edicion de Empleado",$scope.button_title_form="Actualizar Empleado",scroll()},$scope.CancelarEditar=function(){$scope.Empleado={},$scope.panel_title_form="Registro de Empleados",$scope.button_title_form="Registrar Empleado"},function(){$scope.preloader.estado=!0,webServer.getResource("personas",{empleado:!0,contador:!0,almacenista:!0,super_administrador:!0},"get").then(function(data){$scope.Empleados=data.data.datos,$scope.gridOptions.data=data.data.datos,
$scope.preloader.estado=!1},function(data){$scope.Empleados=[],console.log(data.data.message),$scope.preloader.estado=!1})}()}]),angular.module("frontendApp").controller("OrdenVentaCtrl",["$scope","$state","$timeout","webServer","Tabla","BotonesTabla","preloader",function($scope,$state,$timeout,webServer,Tabla,BotonesTabla,preloader){function listarPersonas(){webServer.getResource("personas",{cliente:!0},"get").then(function(data){$scope.clientes=data.data.datos,listarProductos()},function(data){$scope.clientes=[],console.log(data),listarProductos()})}function listarProductos(){webServer.getResource("productos",{producto:!0},"get").then(function(data){data.data?$scope.productos=data.data.datos:$scope.productos=[],listarSalidas()},function(data){$scope.productos=[],console.log(data.data.message),listarSalidas()})}function listarSalidas(){webServer.getResource("salidas",{},"get").then(function(data){$scope.Salidas=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Salidas=[],console.log(data.data.message),$scope.preloader.estado=!1})}function Borrar(id){var conter=!1;$scope.Ordenes.forEach(function(ele,index){ele._id==id&&"Activo"==ele.estado&&(conter=!0)}),conter?($scope.preloader.estado=!0,webServer.getResource("orden_venta/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,index){ele._id==id&&$scope.Ordenes.splice(ele.index,1)}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error")})):swal("Oops...","No se puede eliminar la orden porque ya cuenta con salidas","error")}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarOrden(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,cliente:ele.cliente,productos:ele.productos,observaciones:ele.observaciones,orden_compra_cliente:ele.orden_compra_cliente,fecha_recepcion:new Date(Date.parse(ele.fecha_recepcion)),fecha_entrega:new Date(Date.parse(ele.fecha_entrega)),lugar_entrega:ele.lugar_entrega,estado:ele.estado})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})});$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Almacenista"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta",$scope.Orden={},$scope.Orden.productos=[];var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editarorden+BotonesTabla.Borrarorden),casillaDeBotones+=BotonesTabla.Factura+"</div>",$scope.gridOptions={columnDefs:[{name:"No. de orden",field:"orden_venta_consecutivo",width:"10%",minWidth:100},{name:"cliente",field:"cliente.nombre",width:"30%",minWidth:150},{name:"fecha de solicitud",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha_recepcion)}}</div>",minWidth:150},{field:"estado",width:"15%",minWidth:100},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:150}]},angular.extend($scope.gridOptions,Tabla),$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[],$scope.materias=[],function(){$scope.preloader.estado=!0,webServer.getResource("orden_venta",{Salidas:!0,Finalizado:!0,Activo:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.gridOptions.data=$scope.Ordenes,listarPersonas()},function(data){$scope.Ordenes=[],$scope.gridOptions.data=$scope.Ordenes,console.log(data.data.message),listarPersonas()})}(),$scope.cargarProducto=function(keyEvent){var conter=!0;$scope.productos.forEach(function(ele,index){$scope.Orden.Producto.codigo==ele.codigo&&($scope.Orden.Producto._id=ele._id+","+ele.nombre+","+ele.precio,conter=!1,13===keyEvent.which&&$("#Cantidad").focus())}),conter&&($scope.Orden.Producto._id="")},$scope.detectar=function(keyEvent){""!=$scope.Orden.Producto.cantidad&&13===keyEvent.which&&$scope.AgregarProducto()},$scope.AgregarProducto=function(){var controlador=!1,obj={_id:$scope.Orden.Producto._id.split(",")[0],nombre:$scope.Orden.Producto._id.split(",")[1],precio:parseInt($scope.Orden.Producto._id.split(",")[2]),codigo:$scope.Orden.Producto._id.split(",")[3],cantidad:$scope.Orden.Producto.cantidad,cantidad_faltante:$scope.Orden.Producto.cantidad,cantidad_saliente:0};$scope.Orden.productos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El producto ya esta añadido",4e3):$scope.Orden.productos.push(obj),$scope.Orden.Producto={},$("#codigo_barras").focus()},$scope.Detalles=function(id){$scope.Detalle=$scope.Ordenes.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.productos||($scope.Detalle.productos=[]),$("#modaldeDetalles").modal("open")},$scope.BorrarProducto=function(index){$scope.Orden.productos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la orden de venta?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La orden de venta no se borrará","error")})},$scope.EnviarOrden=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de venta"==$scope.panel_title_form?(ruta="orden_venta",metodo="post"):(ruta="orden_venta/"+$scope.Orden._id,metodo="put"),webServer.getResource(ruta,$scope.Orden,metodo).then(function(data){$scope.clientes.forEach(function(ele,index){ele._id==$scope.Orden.cliente._id&&($scope.Orden.cliente=ele)}),"Registro de venta"==$scope.panel_title_form?($scope.Orden._id=data.data.datos._id,$scope.Orden.orden_venta_consecutivo=data.data.datos.orden_venta_consecutivo,$scope.Ordenes.push($scope.Orden)):($scope.Ordenes[$scope.Orden.index]=$scope.Orden,$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta"),$scope.Orden={},$scope.Orden.productos=[],$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.Orden=IdentificarOrden(id,$scope.Ordenes),"Activo"==$scope.Orden.estado?($scope.panel_title_form="Edicion de Venta",$scope.button_title_form="Actualizar Venta",$scope.Orden.productos||($scope.Orden.productos=[]),scroll()):(sweetAlert("Oops...","La orden de venta no se puede editar porque ya cuenta con salidas","error"),$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[])},$scope.CancelarEditar=function(){$scope.Orden={},$scope.Orden.productos=[],$scope.productos=[],$scope.panel_title_form="Registro de venta",$scope.button_title_form="Registrar venta"},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.Factura=function(param){$state.go("Factura",param)}}]),angular.module("frontendApp").controller("OrdenCompraCtrl",["$state","$scope","$timeout","webServer","Tabla","BotonesTabla","preloader",function($state,$scope,$timeout,webServer,Tabla,BotonesTabla,preloader){function Borrar(id){var conter=!1;$scope.Ordenes.forEach(function(ele,index){ele._id==id&&"Activo"==ele.estado&&(conter=!0)}),conter?($scope.preloader.estado=!0,webServer.getResource("orden_compra/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,index){ele._id==id&&$scope.Ordenes.splice(ele.index,1)}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error")})):swal("Oops...","No se puede eliminar la orden porque ya cuenta con salidas","error")}function scroll(){$("html, body").animate({scrollTop:0},1e3)}function IdentificarOrden(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,proveedor:ele.proveedor,orden_compra_consecutivo:ele.orden_compra_consecutivo,productos:ele.productos,materia_prima:ele.materia_prima,observaciones:ele.observaciones,fecha:ele.fecha})}),obj}function listarPersonas(){webServer.getResource("personas",{proveedorproductos:!0},"get").then(function(data){$scope.proveedores=data.data.datos,listarEntradas()},function(data){$scope.proveedores=[],console.log(data),listarEntradas()})}function listarEntradas(){webServer.getResource("entradas",{},"get").then(function(data){$scope.Entradas=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Entradas=[],console.log(data.data.message),$scope.preloader.estado=!1})}function listarMaterias(){webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.materias=data.data.datos,listarPersonas()},function(data){$scope.materias=[],console.log(data.data.message),listarPersonas()})}function listarProductos(){webServer.getResource("productos",{producto:!0},"get").then(function(data){$scope.productos=data.data.datos,listarMaterias()},function(data){$scope.productos=[],console.log(data.data.message),listarMaterias()})}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})});$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"!=$scope.Usuario.rol&&"Almacenista"!=$scope.Usuario.rol||$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra",$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[];var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Editarorden+BotonesTabla.Borrarorden+"</div>";$scope.gridOptions={columnDefs:[{name:"No. de orden",field:"orden_compra_consecutivo",width:"10%",minWidth:100},{name:"proveedor",field:"proveedor.nombre",width:"30%",minWidth:150},{name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:150},{field:"estado",width:"15%",minWidth:150},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:150}]},angular.extend($scope.gridOptions,Tabla),$scope.Detalles=function(id){$scope.Detalle=$scope.Ordenes.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.materia_prima||($scope.Detalle.materia_prima=[]),$scope.Detalle.productos||($scope.Detalle.productos=[]),$("#modalDetalles").modal("open")},$scope.cargarProducto=function(keyEvent){var conter=!0;$scope.productos.forEach(function(ele,index){$scope.Orden.Producto.codigo==ele.codigo&&($scope.Orden.Producto._id=ele._id+","+ele.nombre,conter=!1),13===keyEvent.which&&$("#Cantidad-producto").focus()}),conter&&($scope.Orden.Producto._id="")},$scope.detectar=function(keyEvent){""!=$scope.Orden.Producto.cantidad&&13===keyEvent.which&&$scope.AgregarProducto()},$scope.AgregarProducto=function(){var controlador=!1,_id=$scope.Orden.Producto._id.split(",")[0],obj={};$scope.productos.forEach(function(ele,index){_id==ele._id&&(obj=ele)}),obj.cantidad=$scope.Orden.Producto.cantidad,obj.cantidad_faltante=$scope.Orden.Producto.cantidad,obj.cantidad_entrante=0,$scope.Orden.productos.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?Materialize.toast("El producto ya esta añadido",4e3):$scope.Orden.productos.push(obj),$scope.Orden.Producto={},$("#codigo_barras").focus()},$scope.AgregarMateria=function(){var controlador=!1,obj={},_id=$scope.Orden.Materia._id.split(",")[0];$scope.materias.forEach(function(ele,index){_id==ele._id&&(obj=ele)}),obj.cantidad=$scope.Orden.Materia.cantidad,obj.cantidad_faltante=$scope.Orden.Materia.cantidad,obj.cantidad_entrante=0,$scope.Orden.materia_prima.forEach(function(ele,index){ele._id==obj._id&&(controlador=!0)}),controlador?(Materialize.toast("La materia prima ya esta añadida",4e3),$scope.Orden.Materia={}):($scope.Orden.materia_prima.push(obj),$scope.Orden.Materia={})},$scope.BorrarMateria=function(index){$scope.Orden.materia_prima.splice(index,1)},$scope.BorrarProducto=function(index){$scope.Orden.productos.splice(index,1)},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la orden de compra?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La orden de compra no se borrará","error")})},$scope.EnviarOrden=function(){$scope.preloader.estado=!0,$scope.Orden.productos.length<1&&($scope.Orden.productos=null),$scope.Orden.materia_prima.length<1&&($scope.Orden.materia_prima=null);var ruta="",metodo="";"Registro de Compra"==$scope.panel_title_form?(ruta="orden_compra",metodo="post"):(ruta="orden_compra/"+$scope.Orden._id,metodo="put"),webServer.getResource(ruta,$scope.Orden,metodo).then(function(data){$scope.proveedores.forEach(function(ele,index){ele._id==$scope.Orden.proveedor._id&&($scope.Orden.proveedor=ele)}),"Registro de Compra"==$scope.panel_title_form?($scope.Orden.estado="Activo",$scope.Orden.fecha=new Date(Date.now()),$scope.Orden._id=data.data.datos._id,$scope.Orden.orden_compra_consecutivo=data.data.datos.orden_compra_consecutivo,$scope.Ordenes.push($scope.Orden)):$scope.Ordenes[$scope.Orden.index]=$scope.Orden,$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Editar=function(id){$scope.Orden=IdentificarOrden(id,$scope.Ordenes),"Activo"==Orden.estado?($scope.panel_title_form="Edicion de Compra",$scope.button_title_form="Actualizar compra",$scope.Orden.productos||($scope.Orden.productos=[]),$scope.Orden.materia_prima||($scope.Orden.materia_prima=[]),scroll()):(sweetAlert("Oops...","No se puede editar la orden de compra porque ya posee entradas","error"),$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[])},$scope.CancelarEditar=function(){$scope.Orden={},$scope.Orden.productos=[],$scope.Orden.materia_prima=[],$scope.productos=[],$scope.materias=[],$scope.panel_title_form="Registro de Compra",$scope.button_title_form="Registrar compra"},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},function(){$scope.preloader.estado=!0,webServer.getResource("orden_compra",{Entradas:!0,Finalizado:!0,Activo:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.gridOptions.data=$scope.Ordenes,listarProductos()},function(data){$scope.Ordenes=[],$scope.gridOptions.data=$scope.Ordenes,console.log(data.data.message),listarProductos()})}()}]),angular.module("frontendApp").constant("BotonesTabla",{Imprimir:'<a type="button" class="btn btn-tabla btn-primary" ng-click="grid.appScope.Imprimir(row.entity)">Imprimir Factura</a>',Detalles:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.Detalles(row.entity._id)">Detalles</a>',Editar:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.Editar(row.entity._id)">Editar</a>',Borrar:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',DetallesModal:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.DetallesModal(row.entity._id)">Detalles</a>',EditarModal:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.EditarModal(row.entity._id)">Editar</a>',BorrarModal:'<a type="button" class="btn btn-tabla btn-danger" ng-click="grid.appScope.BorrarModal(row.entity._id)">Borrar</a>',Salida:'<a type="button" class="btn btn-tabla btn-info" ng-click="grid.appScope.AbrirModalSalida(row.entity._id)">Remisión</a>',Entrada:'<a type="button" class="btn btn-tabla btn-success" ng-click="grid.appScope.AbrirModalEntrada(row.entity._id)">Entrada</a>',MateriaPrima:'<a type="button" class="btn btn-tabla btn-warning" ng-click="grid.appScope.AbrirModalMateriaPrima(row.entity._id)">Materia Prima</a>',Factura:'<a type="button" class="btn btn-tabla btn-info" ng-click="grid.appScope.Factura(row.entity)">Generar Factura</a>',Borrarorden:'<a type="button" class="btn btn-tabla btn-danger" ng-show="row.entity.estado!=grid.appScope.estadoactivoorden" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',Borrarfabricacion:'<a type="button" class="btn btn-tabla btn-danger" ng-show="row.entity.estado!=grid.appScope.estadoactivofab" ng-click="grid.appScope.abrirModal(row.entity._id)">Borrar</a>',Editarorden:'<a type="button" class="btn btn-tabla btn-warning" ng-show="row.entity.estado!=grid.appScope.estadoactivoorden" ng-click="grid.appScope.Editar(row.entity._id)">Editar</a>'}),angular.module("frontendApp").constant("Tabla",{enableSorting:!0,modifierKeysToMultiSelectCells:!0,enableFiltering:!0,paginationPageSizes:[10,20,30,40,50,100],paginationPageSize:10,enableColumnResizing:!0}),angular.module("frontendApp").controller("PerfilCtrl",["$scope","$timeout","SesionUsuario","webServer","preloader",function($scope,$timeout,SesionUsuario,webServer,preloader){function EnviarDatos(actualizo){JSON.stringify($scope.Usuario)!=JSON.stringify(SesionUsuario.ObtenerSesion())?($scope.preloader.estado=!0,webServer.getResource("personas/"+$scope.Usuario._id,$scope.Usuario,"put").then(function(data){SesionUsuario.ActualizarSesion($scope.Usuario),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})):(1==actualizo?($scope.preloader.estado=!1,$scope.Detallemodal.mensaje="Operación realizada con exito"):$scope.Detallemodal.mensaje="No hay ningun dato por actualizar",sweetAlert("Completado...",$scope.Detallemodal.mensaje,"error"))}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.panelAnimate="",$scope.pageAnimate="",$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Perfil",$scope.button_title_form="Actualizar datos",$scope.Usuario=SesionUsuario.ObtenerSesion(),$scope.MiUsuario={},$scope.Detallemodal={},$scope.cambio=!1,$scope.myCroppedImage="",$scope.contador=0;var handleFileSelect=function(evt){angular.element(document.querySelector("#inputval")).text($(this).val());var file=evt.currentTarget.files[0],reader=new FileReader;reader.onload=function(evt){$scope.$apply(function($scope){$scope.contador=4,$scope.myImage=evt.target.result})},reader.readAsDataURL(file)};angular.element(document.querySelector("#fileInput")).on("change",handleFileSelect),$scope.cambiar=function(act){1==act&&$scope.contador<3?$scope.contador=1:2==act&&$scope.contador++,$scope.contador>=3&&($scope.cambio=!0)},$scope.CambiarPss=function(){webServer.getResource("personas/"+$scope.Usuario._id,$scope.Pss,"put").then(function(data){$("#modalPss").modal("close")},function(data){console.log(data)})},$scope.ImageUpdate=function(){$scope.cambio?($scope.preloader.estado=!0,$scope.MiUsuario.myImage=$scope.myCroppedImage,$scope.MiUsuario.Image=$scope.myImage,webServer.getResource("personas/"+$scope.Usuario._id,$scope.MiUsuario,"put").then(function(data){EnviarDatos(1)},function(data){})):EnviarDatos(0)}}]),angular.module("frontendApp").controller("MateriaPrimaCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function scroll(){$("html, body").animate({scrollTop:0},1e3)}function Borrar(id){$scope.preloader.estado=!0,webServer.getResource("fabricacion/"+id,{},"delete").then(function(data){$scope.Materias.forEach(function(ele,index){ele._id==id&&$scope.Materias.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}function IdentificarMateria(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,nombre:ele.nombre,marca:ele.marca,unidad_medida:ele.unidad_medida,min_stock:ele.min_stock,cantidad:ele.cantidad})}),obj}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima",$scope.Materia={},$scope.Materia.unidad_medida={};var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editar+BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{field:"nombre",width:"30%",minWidth:160},{field:"min_stock",width:"20%",minWidth:160},{name:"cantidad",width:"20%",cellTemplate:"<div>{{row.entity.cantidad}} {{row.entity.unidad_medida.nombre}}</div>",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.EnviarMateria=function(){$scope.preloader.estado=!0;var ruta="",metodo="";"Registro de Materia Prima"==$scope.panel_title_form?(ruta="materiaPrima",metodo="post"):(ruta="materiaPrima/"+$scope.Materia._id,metodo="put"),webServer.getResource(ruta,$scope.Materia,metodo).then(function(data){$scope.Unidades.forEach(function(ele,index){ele._id==$scope.Materia.unidad_medida._id&&($scope.Materia.unidad_medida=ele)}),"Registro de Materia Prima"==$scope.panel_title_form?($scope.Materia._id=data.data.datos._id,$scope.Materias.push($scope.Materia)):($scope.Materias[$scope.Materia.index]=$scope.Materia,$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima"),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success"),$scope.Materia={}},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),console.log(data.data.message)})},$scope.Detalles=function(id){$scope.Detalle=$scope.Materias.find(function(ele){if(ele._id==id)return ele}),$("#modalDetalles").modal("open")},$scope.Editar=function(id){$scope.Materia=IdentificarMateria(id,$scope.Materias),$scope.panel_title_form="Edicion de Materia Prima",$scope.button_title_form="Actualizar Materia Prima",scroll()},$scope.CancelarEditar=function(){$scope.panel_title_form="Registro de Materia Prima",$scope.button_title_form="Registrar Materia Prima",$scope.Materia={}},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la materia prima?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La materia prima no se borrará","error")})},function(){$scope.preloader.estado=!0,webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.Materias=data.data.datos,$scope.gridOptions.data=$scope.Materias,$scope.preloader.estado=!1},function(data){console.log(data.data.message),$scope.Materias=[],$scope.gridOptions.data=$scope.Materias,$scope.preloader.estado=!1})}()}]),angular.module("frontendApp").controller("RestaurarCtrl",["$scope","webServer","$state","preloader",function($scope,webServer,$state,preloader){$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.Enviar=function(){$scope.preloader.estado=!0,webServer.getResource("personas/contrasena/",$scope.Usuario,"put").then(function(data){$scope.Usuario={},$scope.preloader.estado=!1,sweetAlert("Completado...","Su contraseña ha sido enviado a su correo","success"),$state.go("InicioSesion")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}}]),angular.module("frontendApp").controller("EntradaCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function Borrar(id){var contador=0,entrada={};$scope.Entradas.forEach(function(ele,index){ele._id==id&&(entrada=ele)}),$scope.Entradas.forEach(function(ele,index){ele.orden_compra._id==entrada.orden_compra._id&&ele._id!=id&&contador++}),entrada.orden_compra.estado=contador>0?"Con Entradas":"Activo",$scope.preloader.estado=!0,webServer.getResource("entradas/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,ind){ele._id==$scope.Entrada.orden_compra._id&&($scope.Ordenes[ind]=data.data.datos.orden_compra)}),$scope.Entradas.forEach(function(ele,index){ele._id==id&&$scope.Entradas.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),console.log(data.data.message)})}function listarOrdenes(){webServer.getResource("orden_compra",{Activo:!0,Entradas:!0,Finalizado:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Ordenes=[],console.log(data.data.message),$scope.preloader.estado=!1})}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.panelAnimate="",$scope.pageAnimate="","Contador"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Entradas",$scope.button_title_form="Registrar Entrada",$scope.Entrada={},$scope.Entrada.orden_compra=[],$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[];var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{name:"No. entrada",field:"entrada_consecutivo",width:"15%",minWidth:100},{name:"orden de compra",field:"orden_compra.orden_compra_consecutivo",width:"15%",minWidth:100},{name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:100},{name:"proveedor",field:"orden_compra.proveedor.nombre",width:"30%",minWidth:250},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"25%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.CancelarEditar=function(){$scope.Entrada={},$scope.Entrada.orden_compra={},$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[],$scope.Orden.compra=""},$scope.CargarOrden=function(){$scope.Ordenes.forEach(function(ele,index){ele._id==$scope.Orden.compra&&($scope.Entrada.orden_compra=ele)}),$scope.Entrada.orden_compra.productos||($scope.Entrada.orden_compra.productos=[]),$scope.Entrada.orden_compra.materia_prima||($scope.Entrada.orden_compra.materia_prima=[])},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la entrada?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La entrada no se borrará","error")})},$scope.EnviarEntrada=function(){$scope.preloader.estado=!0,$scope.Entrada.orden_compra.productos&&$scope.Entrada.orden_compra.productos.forEach(function(ele,index){ele.cantidad_faltante>0?ele.cantidad_entrante=angular.element("#cantidad"+ele._id).val():ele.cantidad_entrante=0}),$scope.Entrada.orden_compra.materia_prima&&$scope.Entrada.orden_compra.materia_prima.forEach(function(ele,index){ele.cantidad_faltante>0?ele.cantidad_entrante=angular.element("#cantidad"+ele._id).val():ele.cantidad_entrante=0}),$scope.Entrada.estado="Activo",webServer.getResource("entradas",$scope.Entrada,"post").then(function(data){$scope.Entrada.fecha=new Date(Date.now()),$scope.Entrada._id=data.data.datos._id,$scope.Entrada.entrada_consecutivo=data.data.datos.entrada_consecutivo,$scope.Entradas.push($scope.Entrada),$scope.Ordenes.forEach(function(ele,ind){ele._id==$scope.Entrada.orden_compra._id&&($scope.Ordenes[ind]=data.data.datos.orden_compra)}),$scope.Entrada={},$scope.Entrada.orden_compra={},$scope.Entrada.orden_compra.productos=[],$scope.Entrada.orden_compra.materia_prima=[],$scope.Orden.compra="",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),console.log(data.data.message)})},$scope.Detalles=function(id){$scope.Detalle=$scope.Entradas.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.orden_compra.materia_prima||($scope.Detalle.orden_compra.materia_prima=[]),$scope.Detalle.orden_compra.productos||($scope.Detalle.orden_compra.productos=[]),$("#modaldeDetalles").modal("open")},function(){$scope.preloader.estado=!0,webServer.getResource("Entradas",{},"get").then(function(data){$scope.Entradas=data.data.datos,$scope.gridOptions.data=$scope.Entradas,listarOrdenes()},function(data){$scope.Entradas=[],$scope.gridOptions.data=$scope.Entradas,console.log(data.data.message),listarOrdenes()})}()}]),angular.module("frontendApp").controller("SalidaCtrl",["$state","$scope","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,$timeout,Tabla,BotonesTabla,webServer,preloader){function Borrar(id){$scope.preloader.estado=!0,webServer.getResource("salidas/"+id,{},"delete").then(function(data){$scope.Ordenes.forEach(function(ele,ind){ele._id==$scope.Entrada.orden_venta._id&&($scope.Ordenes[ind]=data.data.datos.orden_venta)}),$scope.Salidas.forEach(function(ele,ind){ele._id==id&&$scope.Salidas.splice(ele.index,1)}),$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}function listarOrdenes(){webServer.getResource("orden_venta",{Activo:!0,Salidas:!0,Finalizado:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.Ordenes=[],$scope.gridOptions.data=$scope.Ordenes,console.log(data.data.message),$scope.preloader.estado=!1})}$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$scope.preloader=preloader,$scope.preloader.estado=!1,$scope.panelAnimate="",$scope.pageAnimate="",
"Contador"==$scope.Usuario.rol&&$state.go("Home"),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.panel_title_form="Registro de Salidas",$scope.button_title_form="Registrar salida",$scope.Salida={},$scope.Salida.orden_venta={},$scope.Salida.orden_venta.productos=[];var casillaDeBotones="<div>"+BotonesTabla.Detalles;"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Borrar),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{name:"orden de venta",field:"orden_venta.orden_venta_consecutivo",width:"15%",minWidth:100},{name:"no. salida",field:"salida_consecutivo",width:"15%",minWidth:100},{name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:100},{name:"cliente",field:"orden_venta.cliente.nombre",width:"25%",minWidth:150},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:150}]},angular.extend($scope.gridOptions,Tabla),$scope.CargarOrden=function(){$scope.Ordenes.forEach(function(ele,index){ele._id==$scope.Orden.venta&&($scope.Salida.orden_venta=ele)}),$scope.Salida.orden_venta.productos?$scope.Salida.orden_venta.productos.forEach(function(ele,index){0==ele.cantidad_faltante&&$scope.Entrada.orden_venta.productos.splice(ele.index,1)}):$scope.Salida.orden_venta.productos=[]},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la salida?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La salida no se borrará","error")})},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.cancelarEditar=function(){$scope.Salida={},$scope.Salida.orden_venta={},$scope.Salida.orden_venta.productos=[],$scope.Orden.venta=""},$scope.EnviarSalida=function(){$scope.preloader.estado=!0,$scope.Salida.orden_venta.productos&&$scope.Salida.orden_venta.productos.forEach(function(ele,index){ele.cantidad_saliente=angular.element("#cantidad"+ele._id).val(),ele.cantidad_faltante=parseInt(ele.cantidad_faltante)-parseInt(ele.cantidad_saliente)}),webServer.getResource("salidas",$scope.Salida,"post").then(function(data){$scope.Salida.salida_consecutivo=data.data.datos.salida_consecutivo,$scope.Salida._id=data.data.datos._id,$scope.Salidas.push($scope.Salida),$scope.Ordenes.forEach(function(ele,ind){ele._id==$scope.Entrada.orden_venta._id&&($scope.Ordenes[ind]=data.data.datos.orden_venta)}),$scope.Salida={},$scope.Salida.orden_venta={},$scope.Salida.orden_venta.productos=[],$scope.Orden.venta="",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.Detalles=function(id){$scope.Detalle=$scope.Salidas.find(function(ele){if(ele._id==id)return ele}),$scope.Detalle.orden_venta.productos||($scope.Detalle.orden_venta.productos=[]),$("#modaldeDetalles").modal("open")},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},function(){$scope.preloader.estado=!0,webServer.getResource("salidas",{},"get").then(function(data){$scope.Salidas=data.data.datos,$scope.gridOptions.data=$scope.Salidas,listarOrdenes()},function(data){$scope.Salidas=[],$scope.gridOptions.data=$scope.Salidas,console.log(data.data.message),listarOrdenes()})}()}]),angular.module("frontendApp").controller("FabricacionCtrl",["$state","$scope","server","$timeout","Tabla","BotonesTabla","webServer","preloader",function($state,$scope,server,$timeout,Tabla,BotonesTabla,webServer,preloader){function Borrar(id){var controler=!0;$scope.Fabricaciones.forEach(function(ele,index){ele._id==id&&"En Fabricacion"!=ele.estado&&(controler=!1)}),controler?($scope.preloader.estado=!0,webServer.getResource("fabricacion/"+id,{},"delete").then(function(data){$scope.Fabricaciones.forEach(function(ele,index){ele._id==id&&$scope.Fabricaciones.splice(ele.index,1)}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error")})):swal("Oops...","La fabricación no se puede eliminar porque ya posee productos dentro del inventario","error")}function EnviarFabricacion(){$scope.preloader.estado=!0;var metodo="",ruta="";"Registrar fabricación"==$scope.button_title_form?($scope.fabricacion.fecha_solicitud=new Date(Date.now()),metodo="post",ruta="fabricacion",$scope.fabricacion.estado="En Fabricacion",$scope.fabricacion.estado_remision="Sin Remision"):(metodo="put",ruta="fabricacion/"+$scope.fabricacion._id),"orden"!=$scope.check&&delete $scope.fabricacion.orden_venta,webServer.getResource(ruta,$scope.fabricacion,metodo).then(function(data){"Registrar fabricación"==$scope.button_title_form?($scope.fabricacion.fabricacion_consecutivo=data.data.datos.fabricacion_consecutivo,$scope.fabricacion._id=data.data.datos._id,$scope.Fabricaciones.push($scope.fabricacion)):$scope.Fabricaciones[$scope.fabricacion.index]=$scope.fabricacion,$scope.fabricacion={},$scope.fabricacion.productos=[],$scope.fabricacion.procesos=[],$scope.proceso={},$scope.producto={},$scope.panel_title_form="Registro de Fabricacion",$scope.button_title_form="Registrar fabricación",$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})}function listarFabricaciones(){webServer.getResource("fabricacion",{},"get").then(function(data){$scope.Fabricaciones=data.data.datos,$scope.gridOptions.data=$scope.Fabricaciones,listarMaterias()},function(data){$scope.Fabricaciones=[],$scope.gridOptions.data=$scope.Fabricaciones,console.log(data.data.message),listarMaterias()})}function listarProductos(){webServer.getResource("productos",{producto:!0},"get").then(function(data){$scope.Productos=data.data.datos,listarRemisiones()},function(data){$scope.Productos=[],console.log(data.data.message),listarRemisiones()})}function listarMaterias(){webServer.getResource("materiaPrima",{},"get").then(function(data){$scope.Materias=data.data.datos,listarSalidasInsumos()},function(data){$scope.Materias=[],console.log(data.data.message),listarSalidasInsumos()})}function listarRemisiones(){webServer.getResource("remision",{},"get").then(function(data){$scope.Remisiones=data.data.datos,listarEntradasFabricaciones()},function(data){$scope.Remisiones=[],console.log(data.data.message),listarEntradasFabricaciones()})}function listarSalidasInsumos(){webServer.getResource("fabricacion/insumos",{},"get").then(function(data){$scope.SalidasInsumos=data.data.datos,$scope.preloader.estado=!1},function(data){$scope.SalidasInsumos=[],console.log(data.data.message),$scope.preloader.estado=!1})}function listarEntradasFabricaciones(){webServer.getResource("entrada/remision",{},"get").then(function(data){$scope.EntradasFabricaciones=data.data.datos,listarFabricaciones()},function(data){$scope.EntradasFabricaciones=[],console.log(data.data.message),listarFabricaciones()})}function listarPersonas(){webServer.getResource("personas",{empleado:!0,proveedorfabricacion:!0},"get").then(function(data){$scope.personas=data.data.datos,listarProductos()},function(data){$scope.personas=[],listarProductos()})}function IdentificarFabricacion(id,arrObj){var obj;return arrObj.forEach(function(ele,index){ele._id==id&&(obj={index:index,_id:ele._id,fecha_entrega:new Date(Date.parse(ele.fecha_entrega)),fecha_solicitud:new Date(Date.parse(ele.fecha_solicitud)),productos:ele.productos,procesos:ele.procesos,orden_venta:ele.orden_venta})}),obj}$scope.panelAnimate="",$scope.pageAnimate="",$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),"Contador"==$scope.Usuario.rol&&$state.go("Home");$scope.preloader=preloader,$scope.panel_title_form="Registro de Fabricaciones",$scope.button_title_form="Registrar fabricación",$scope.check="orden",$scope.fabricacion={},$scope.modal={},$scope.fabricacion.productos=[],$scope.fabricacion.procesos=[],$scope.contenido_fabricacion={},$scope.modal_salida={},$scope.modal_salida.productos=[],$scope.Remisiones=[],$scope.cancelarentrada={},$scope.cancelarsalida={},$scope.server=server;var casillaDeBotones;casillaDeBotones="<div>"+BotonesTabla.Detalles,"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Editar),casillaDeBotones+=BotonesTabla.Salida+BotonesTabla.Entrada+BotonesTabla.MateriaPrima,"Super Administrador"==$scope.Usuario.rol&&(casillaDeBotones+=BotonesTabla.Borrarfabricacion),casillaDeBotones+="</div>",$scope.gridOptions={columnDefs:[{name:"no. orden",field:"fabricacion_consecutivo",width:"10%",minWidth:100},{name:"fecha de solicitud",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha_solicitud)}}</div>",minWidth:100},{name:"fecha de entrega",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha_entrega)}}</div>",width:"15%",minWidth:100},{field:"estado",width:"15%",minWidth:100},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"45%",minWidth:230}]},angular.extend($scope.gridOptions,Tabla),$scope.CargarOrden=function(){$scope.Ordenes.forEach(function(ele,index){ele._id==$scope.Orden&&($scope.fabricacion.orden_venta=ele)}),$scope.fabricacion.orden_venta.productos||($scope.fabricacion.orden_venta.productos=[]),$scope.fabricacion.productos=$scope.fabricacion.orden_venta.productos},$scope.cambiar=function(){$scope.fabricacion={},$scope.fabricacion.productos=[],$scope.fabricacion.procesos=[],$scope.proceso={},$scope.producto={},$scope.Orden=""},$scope.Detalles=function(id){$scope.Detalle=$scope.Fabricaciones.find(function(ele){if(ele._id==id)return ele}),$("#modaldeDetalles").modal("open")},$scope.BorrarProducto=function(index){$scope.fabricacion.productos.splice(index,1)},$scope.abrirModalCrear=function(){var titulo="",boton="",mensaje="";"Registrar fabricación"==$scope.button_title_form?(titulo="Confirmar Registro",boton="Si, Registrar!",mensaje="La fabricación no se registrará"):(titulo="Confirmar Cambios",boton="Si, Actualizar!",mensaje="La fabricación no se actualizará"),swal({title:titulo,text:"¿Esta seguro que ha suministrado los responsables de los procesos y desea registrar la fabricación?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:boton,cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?EnviarFabricacion():swal("Cancelado",mensaje,"error")})},$scope.abrirModal=function(_id){swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la fabricación?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(_id):swal("Cancelado","La fabricación no se borrará","error")})},$scope.Editar=function(id){$scope.panel_title_form="Edicion de Fabricación",$scope.button_title_form="Actualizar Fabricación",$scope.fabricacion=IdentificarFabricacion(id,$scope.Fabricaciones),$scope.fabricacion.orden_venta?$scope.check="orden":$scope.check="stock"},$scope.CancelarEditar=function(){$scope.panel_title_form="Registro de Fabricaciones",$scope.button_title_form="Registrar fabricación",$scope.check="orden",$scope.fabricacion={},$scope.fabricacion.productos=[],$scope.fabricacion.procesos=[],$scope.proceso={},$scope.producto={}},$scope.cargarProducto=function(keyEvent){var conter=!0;$scope.Productos.forEach(function(ele,index){$scope.producto.codigo==ele.codigo&&($scope.producto._id=ele._id+","+ele.nombre,conter=!1,13===keyEvent.which&&$("#Cantidad").focus())}),conter&&($scope.producto._id="")},$scope.detectar=function(keyEvent){""!=$scope.producto.cantidad&&13===keyEvent.which&&$scope.AgregarProducto()},$scope.AgregarProducto=function(){var controlador=!1,obj={_id:$scope.producto._id.split(",")[0],nombre:$scope.producto._id.split(",")[1],fabricado:$scope.producto._id.split(",")[2],cantidad:$scope.producto.cantidad,cantidad_saliente:0,cantidad_fabricada:0,cantidad_disponible:$scope.producto.cantidad};$scope.fabricacion.productos.forEach(function(ele,index){ele._id==obj._id&&(ele.cantidad=ele.cantidad+$scope.producto.cantidad,ele.cantidad_disponible=ele.cantidad_disponible+$scope.producto.cantidad,controlador=!0)}),controlador?Materialize.toast("La cantidad se ha sumado al producto ya añadido",4e3):$scope.fabricacion.productos.push(obj),$scope.producto={},$("#codigo_barras").focus()},$scope.AgregarProceso=function(){var controler=!1,proceso={_id:$scope.proceso._id.split(",")[0],nombre:$scope.proceso._id.split(",")[1],tipo:$scope.proceso._id.split(",")[2],array_responsables:[]};$scope.fabricacion.procesos.forEach(function(ele,index){ele._id==proceso._id&&(controler=!0)}),controler?Materialize.toast("El proceso ya esta añadido",4e3):$scope.fabricacion.procesos.push(proceso),$scope.proceso={}},$scope.BorrarProceso=function(index){var responsables=$scope.fabricacion.procesos[index].array_responsables;$scope.personas=$scope.personas.concat(responsables),$scope.fabricacion.procesos.splice(index,1)},$scope.AbrirModal=function(proceso){$scope.modal.proceso=proceso,$("#modalResponsables").modal("open")},$scope.addresponsable=function(){if($scope.modal.proceso.array_responsables.lenght<1){var res=JSON.parse($scope.from_modal.persona),index=null;$scope.modal.proceso.array_responsables.push(res),$scope.personas.forEach(function(ele,i){res._id==ele._id&&(index=i)}),$scope.personas.splice(index,1)}else Materialize.toast("No se puede añadir mas de un responsable al proceso",4e3)},$scope.removeresponsable=function(index){var res=$scope.modal.proceso.array_responsables[index];$scope.personas.push(res),$scope.modal.proceso.array_responsables.splice(index,1)},$scope.AbrirModalSalida=function(_id){$scope.Fabricaciones.forEach(function(ele,i){_id==ele._id&&($scope.contenido_fabricacion=ele)}),$scope.modal_salida={},$scope.cancelarsalida={},$scope.modal_salida.productos=[],$("#modalSalidas").modal("open")},$scope.addproducto=function(){var res=JSON.parse($scope.modal_salida.producto);res.cantidad_disponible=res.cantidad_disponible-$scope.modal_salida.cantidad,res.cantidad_saliente=res.cantidad_saliente+$scope.modal_salida.cantidad,$scope.contenido_fabricacion.productos.forEach(function(ele,i){if(res._id==ele._id)if($scope.modal_salida.cantidad<=ele.cantidad_disponible){ele.cantidad_disponible=ele.cantidad_disponible-$scope.modal_salida.cantidad,ele.cantidad_saliente=ele.cantidad_saliente+$scope.modal_salida.cantidad;var obj={producto:ele,cantidad:$scope.modal_salida.cantidad,cantidad_faltante:$scope.modal_salida.cantidad};$scope.modal_salida.productos.push(obj),$scope.modal_salida.cantidad="",$scope.modal_salida.producto=""}else Materialize.toast("Error al intentar agregar el producto, la cantidad a sacar es mayor a la cantidad disponible",4e3),res.cantidad_disponible=res.cantidad_disponible+$scope.modal_salida.cantidad,res.cantidad_saliente=res.cantidad_saliente-$scope.modal_salida.cantidad})},$scope.removerproducto=function(producto){$scope.contenido_fabricacion.productos.forEach(function(ele,i){producto.producto._id==ele._id&&(ele.cantidad_disponible=ele.cantidad_disponible+producto.cantidad,ele.cantidad_saliente=ele.cantidad_saliente-producto.cantidad)}),$scope.modal_salida.productos.splice(producto.index,1)},$scope.cargarProceso=function(){$scope.modal_salida.proceso=JSON.parse($scope.modal_salida.carga_proceso)},$scope.enviarRemision=function(){$scope.preloader.estado=!0,$scope.modal_salida.estado="Sin Entrada",$scope.modal_salida.fabricacion=$scope.contenido_fabricacion,$scope.modal_salida.generado=$scope.Usuario,webServer.getResource("remision",$scope.modal_salida,"post").then(function(data){$scope.Fabricaciones.forEach(function(ele,i){$scope.contenido_fabricacion._id==ele._id&&(ele.productos=$scope.contenido_fabricacion.productos)}),$scope.modal_salida._id=data.data.datos._id,$scope.modal_salida.remision_consecutivo=data.data.datos.remision_consecutivo,$scope.Remisiones.push($scope.modal_salida),$scope.modal_salida={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.abrircancelarremision=function(remision){$scope.cancelarsalida=remision,swal({title:"Cancelar remisión",text:"Por favor ingrese las observaciones:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Observaciones"},function(inputValue){return!1!==inputValue&&(""===inputValue?(swal.showInputError("El campo es requerido"),!1):($scope.cancelarsalida.observaciones=inputValue,void $scope.cancelarlaremision()))})},$scope.cancelarlaremision=function(){var remision=$scope.cancelarsalida;"Con Entrada"==remision.estado?Materialize.toast("La remisión no se puede cancelar ya que hay productos que ya ingresaron a inventario",4e3):($scope.preloader.estado=!0,remision.productos.forEach(function(elemento,index){$scope.contenido_fabricacion.productos.forEach(function(ele,i){elemento.producto._id==ele._id&&(ele.cantidad_disponible=ele.cantidad_disponible+elemento.cantidad,ele.cantidad_saliente=ele.cantidad_saliente-elemento.cantidad)})}),remision.fabricacion=$scope.contenido_fabricacion,webServer.getResource("remision/"+remision._id,remision,"put").then(function(data){$scope.Remisiones.forEach(function(ele,i){ele._id==remision._id&&(ele.estado="Cancelada")}),$scope.Fabricaciones.forEach(function(ele,i){$scope.contenido_fabricacion._id==ele._id&&(ele.productos=$scope.contenido_fabricacion.productos)}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error")}))},$scope.AbrirModalEntrada=function(_id){$scope.Fabricaciones.forEach(function(ele,i){_id==ele._id&&($scope.contenido_fabricacion=ele)}),$scope.modal_entrada={},$scope.cancelarentrada={},$scope.modal_entrada.productos=[],$scope.check_modal_entrada="entrada",$("#modalEntradas").modal("open")},$scope.addproductoentrada=function(){var res=JSON.parse($scope.modal_entrada.producto);res.cantidad_disponible=res.cantidad_disponible-$scope.modal_entrada.cantidad,res.cantidad_cantidad_fabricada=res.cantidad_cantidad_fabricada+$scope.modal_entrada.cantidad,$scope.contenido_fabricacion.productos.forEach(function(ele,i){if(res._id==ele._id)if($scope.modal_entrada.cantidad<=ele.cantidad_disponible){ele.cantidad_disponible=ele.cantidad_disponible-$scope.modal_entrada.cantidad,ele.cantidad_fabricada=ele.cantidad_fabricada+$scope.modal_entrada.cantidad;var obj={producto:ele,cantidad:$scope.modal_entrada.cantidad};$scope.modal_entrada.productos.push(obj),$scope.modal_entrada.cantidad="",$scope.modal_entrada.producto=""}else Materialize.toast("Error al intentar agregar el producto, la cantidad a ingresar es mayor a la cantidad disponible",4e3),res.cantidad_disponible=res.cantidad_disponible+$scope.modal_entrada.cantidad,res.cantidad_cantidad_fabricada=res.cantidad_cantidad_fabricada-$scope.modal_entrada.cantidad})},$scope.removerproductoentrada=function(producto){"entrada"==$scope.check_modal_entrada&&$scope.contenido_fabricacion.productos.forEach(function(ele,i){producto.producto._id==ele._id&&(ele.cantidad_disponible=ele.cantidad_disponible+producto.cantidad,ele.cantidad_fabricada=ele.cantidad_fabricada-producto.cantidad)}),$scope.modal_entrada.productos.splice(producto.index,1)},$scope.cargarRemision=function(){var res=JSON.parse($scope.modal_entrada.carga_remision);$scope.modal_entrada.remision=res,$scope.modal_entrada.productos=res.productos,$scope.modal_entrada.productos.forEach(function(ele,index){ele.cantidad_faltante<1&&$scope.modal_entrada.productos.splice(index,1)})},$scope.enviarEntrada=function(){var controlador_enviar=!0;if("remision"==$scope.check_modal_entrada){var controler=!0;if($scope.modal_entrada.productos.forEach(function(ele,index){angular.element("#cantidad"+ele.producto._id).val()>ele.cantidad_faltante&&(controler=!1,controlador_enviar=!1,Materialize.toast("La cantidad de "+ele.producto.nombre+" a sacar es mayor a la cantidad disponible",4e3))}),controler){var contador=0;contador1=0,$scope.modal_entrada.remision.productos.forEach(function(ele,index){var cantidad=angular.element("#cantidad"+ele.producto._id).val();cantidad&&(ele.cantidad_faltante=ele.cantidad_faltante-cantidad),contador1++,ele.cantidad_faltante<1&&contador++}),$scope.modal_entrada.remision.estado=contador==contador1?"Completada":"Con Entrada",$scope.Remisiones.forEach(function(ele,index){ele._id>=$scope.modal_entrada.remision._id&&(ele=$scope.modal_entrada.remision)}),$scope.modal_entrada.productos.forEach(function(ele,index){ele.cantidad=angular.element("#cantidad"+ele.producto._id).val(),delete ele.cantidad_faltante}),$scope.modal_entrada.productos.forEach(function(elemento,index){$scope.contenido_fabricacion.productos.forEach(function(ele,i){ele._id==elemento.producto._id&&(ele.cantidad_saliente=ele.cantidad_saliente-elemento.cantidad,ele.cantidad_fabricada=ele.cantidad_fabricada+elemento.cantidad)})});var conta=0,conta1=0;$scope.contenido_fabricacion.productos.forEach(function(ele,i){conta++,ele.cantidad_saliente<1&&ele.cantidad_disponible<1&&conta1++}),$scope.contenido_fabricacion.estado=conta1==conta?"Completa":"Incompleta"}}else{var contador=0,contador1=0;$scope.contenido_fabricacion.productos.forEach(function(ele,i){contador++,ele.cantidad_fabricada==ele.cantidad&&contador1++}),$scope.contenido_fabricacion.estado=contador1==contador?"Completa":"Incompleta"}controlador_enviar&&($scope.preloader.estado=!0,$scope.modal_entrada.fabricacion=$scope.contenido_fabricacion,webServer.getResource("entrada/remision",$scope.modal_entrada,"post").then(function(data){$scope.Fabricaciones.forEach(function(ele,i){$scope.contenido_fabricacion._id==ele._id&&(ele=$scope.contenido_fabricacion)}),$scope.modal_entrada._id=data.data.datos._id,$scope.modal_entrada.entrada_remision_consecutivo=data.data.datos.entrada_remision_consecutivo,$scope.EntradasFabricaciones.push($scope.modal_entrada),$scope.modal_entrada={},$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")}))},$scope.cancelarlaentrada=function(){$scope.preloader.estado=!0;var entrada=$scope.cancelarentrada,controlerfab=!0;if(entrada.estado="Cancelada",entrada.remision){var controler=!0;entrada.productos.forEach(function(elemento,index){$scope.contenido_fabricacion.productos.forEach(function(ele,i){elemento.producto._id==ele._id&&(ele.cantidad_afuera=ele.cantidad_afuera+elemento.cantidad,ele.cantidad_fabricada=ele.cantidad_fabricada-elemento.cantidad),ele.cantidad_fabricada>0&&(controlerfab=!1)})}),entrada.productos.forEach(function(elemento,index){entrada.remision.productos.forEach(function(ele,i){elemento.producto._id==ele.producto._id&&(ele.cantidad_faltante=ele.cantidad_faltante+elemento.cantidad),ele.cantidad_faltante<ele.cantidad&&(controler=!1)})}),entrada.remision.estado=controler?"Sin Entrada":"Con Entrada"}else entrada.productos.forEach(function(elemento,index){$scope.contenido_fabricacion.productos.forEach(function(ele,i){elemento.producto._id==ele._id&&(ele.cantidad_disponible=ele.cantidad_disponible+elemento.cantidad,ele.cantidad_fabricada=ele.cantidad_fabricada-elemento.cantidad),ele.cantidad_fabricada>0&&(controlerfab=!1)})});$scope.contenido_fabricacion.estado=controlerfab?"En Fabricacion":"Incompleta",entrada.fabricacion=$scope.contenido_fabricacion,webServer.getResource("entrada/remision/"+entrada._id,entrada,"put").then(function(data){entrada.remision&&$scope.Remisiones.forEach(function(ele,index){ele._id==entrada.remision._id&&(ele=entrada.remision)}),$scope.EntradasFabricaciones.forEach(function(ele,i){ele._id==entrada._id&&(ele=entrada)}),$scope.Fabricaciones.forEach(function(ele,i){$scope.contenido_fabricacion._id==ele._id&&(ele=$scope.contenido_fabricacion)}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success"),$scope.cancelarentrada={}},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error"),$scope.cancelarentrada={}})},$scope.abrircancelarentrada=function(entrada){$scope.cancelarentrada=entrada,swal({title:"Cancelar entrada",text:"Por favor ingrese las observaciones:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Observaciones"},function(inputValue){return!1!==inputValue&&(""===inputValue?(swal.showInputError("El campo es requerido"),!1):($scope.cancelarentrada.observaciones=inputValue,void $scope.cancelarlaentrada()))})},$scope.AbrirModalMateriaPrima=function(_id){$scope.salida_insumos={},$scope.Fabricaciones.forEach(function(ele,i){_id==ele._id&&($scope.salida_insumos.fabricacion=ele)}),$scope.salida_insumos.productos=[],$scope.salida_insumos.materia_prima=[],$("#modalMateriaPrima").modal("open")},$scope.addmateriainsumo=function(){var controlador=!1,materia=JSON.parse($scope.salida_materia.Materia),obj={materia:materia,cantidad:$scope.salida_materia.cantidadMateria};$scope.salida_insumos.materia_prima.forEach(function(ele,index){ele._id==materia._id&&(controlador=!0)}),$scope.Materias.forEach(function(ele,index){ele._id==materia._id&&(controlador?Materialize.toast("La materia prima ya esta añadida",4e3):$scope.salida_materia.cantidadMateria<ele.cantidad?$scope.salida_insumos.materia_prima.push(obj):Materialize.toast("Lo sentimos, pero no posee esa cantidad en inventario",4e3))}),$scope.salida_materia={}},$scope.addproductoinsumo=function(){var controlador=!1,producto=JSON.parse($scope.salida_productos.producto),obj={producto:producto,cantidad:$scope.salida_productos.cantidad};$scope.salida_insumos.productos.forEach(function(ele,index){ele._id==producto._id&&(controlador=!0)}),$scope.Productos.forEach(function(ele,index){ele._id==producto._id&&(controlador?Materialize.toast("El producto ya esta añadido",4e3):$scope.salida_productos.cantidad<ele.cantidad?$scope.salida_insumos.productos.push(obj):Materialize.toast("Lo sentimos, pero no posee esa cantidad en inventario",4e3))}),$scope.salida_productos={}},$scope.removermateriainsumo=function(index){$scope.salida_insumos.materia_prima.splice(index,1)},$scope.removerproductoinsumo=function(index){$scope.salida_insumos.productos.splice(index,1)},$scope.enviarSalidaInsumos=function(){$scope.preloader.estado=!0,$scope.salida_insumos.productos.forEach(function(ele,ind){ele.producto.cantidad=ele.producto.cantidad-ele.cantidad}),$scope.salida_insumos.materia_prima.forEach(function(ele,ind){ele.materia.cantidad=ele.materia.cantidad-ele.cantidad}),webServer.getResource("fabricacion/insumos",$scope.salida_insumos,"post").then(function(data){$scope.salida_insumos._id=data.data.id,$scope.Productos.forEach(function(elemento,index){$scope.salida_insumos.productos.forEach(function(ele,ind){elemento._id==ele.producto._id&&(elemento=ele.producto)})}),$scope.Materias.forEach(function(elemento,index){$scope.salida_insumos.materia_prima.forEach(function(ele,ind){elemento._id==ele.materia._id&&(elemento=ele.materia)})}),$scope.SalidasInsumos.push($scope.salida_insumos),$scope.salida_insumos.productos=[],$scope.salida_insumos.materia=[],$scope.preloader.estado=!1,sweetAlert("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error")})},$scope.abrircancelarsalidainsumos=function(salida){$scope.cancelarsalidainsumos=salida,swal({title:"Cancelar la salida de insumos",text:"Por favor ingrese las observaciones:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"Observaciones"},function(inputValue){return!1!==inputValue&&(""===inputValue?(swal.showInputError("El campo es requerido"),!1):($scope.cancelarsalidainsumos.observaciones=inputValue,void $scope.cancelarlasalidainsumos()))})},$scope.cancelarlasalidainsumos=function(){$scope.preloader.estado=!0;var salida=$scope.cancelarsalidainsumos;salida.productos&&salida.productos.forEach(function(ele,ind){ele.producto.cantidad=ele.producto.cantidad+ele.cantidad}),salida.materia_prima&&salida.materia_prima.forEach(function(ele,ind){ele.materia.cantidad=ele.materia.cantidad+ele.cantidad}),salida.fabricacion=$scope.contenido_fabricacion,webServer.getResource("fabricacion/insumos"+salida._id,salida,"put").then(function(data){$scope.SalidasInsumos.forEach(function(ele,i){ele._id==salida._id&&(ele.estado="Cancelada")}),salida.productos&&$scope.Productos.forEach(function(elemento,index){salida.productos.forEach(function(ele,ind){elemento._id==ele.producto._id&&(elemento=ele.producto)})}),salida.materia_prima&&$scope.Materias.forEach(function(elemento,index){salida.materia_prima.forEach(function(ele,ind){elemento._id==ele.materia._id&&(elemento=ele.materia)})}),$scope.preloader.estado=!1,swal("Completado...",data.data.message,"success")},function(data){$scope.preloader.estado=!1,swal("Oops...",data.data.message,"error")})},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},function(){$scope.preloader.estado=!0,webServer.getResource("orden_venta",{Salidas:!0,Activo:!0},"get").then(function(data){$scope.Ordenes=data.data.datos,listarPersonas()},function(data){$scope.Ordenes=[],console.log(data.data.message),listarPersonas()})}()}]),angular.module("frontendApp").directive("preloader",["preloader",function(preloader){return{templateUrl:"views/directives/preloader.html",restrict:"E",link:function(scope,e,attrs){var el=e[0].getElementsByTagName("SPAN"),i=0;setInterval(function(){$(el[i]).hasClass("animacion")?el[i].className="":el[i].className="animacion",el.length-1>i?i++:i=0},150)},controller:"DashboardCtrl"}}]),angular.module("frontendApp").factory("preloader",function(){return{estado:!1}}),angular.module("frontendApp").controller("FacturaCtrl",["$scope","$state","preloader","BotonesTabla","server","webServer","numeroaletras","$timeout",function($scope,$state,preloader,BotonesTabla,server,webServer,numeroaletras,$timeout){function Borrar(ele){preloader.estado=!0,webServer.getResource("facturas/"+ele._id,{},"put").then(function(data){swal("Ok",data.data.message,"success"),preloader.estado=!1,$scope.Facturas.splice(ele.index,1)},function(data){swal("Error",data.data.message,"error"),preloader.estado=!1})}function identificar(id,arreglo){var obj=null;return arreglo.forEach(function(ele,index){ele._id==id&&(obj=ele,obj.index=index)}),obj}$scope.panelAnimate="",$scope.pageAnimate="",$(document).ready(function(){$(".modal").modal(),$(".modal").modal({dismissible:!0,opacity:0,inDuration:300,outDuration:200,startingTop:"10%",endingTop:"15%",ready:function(modal,trigger){},complete:function(){}})}),$timeout(function(){$scope.pageAnimate="pageAnimate",$scope.panelAnimate="panelAnimate"},100),$scope.newFactura=!0,$scope.server=server,$scope.fecha=function(){var date=(new Date).getDate();return date+=" / "+((new Date).getMonth()+1),date+=" / "+(new Date).getFullYear()}(),$scope.iva=19,$scope.valorIva=0,$scope.subtotal=0,$scope.total=0,$scope.Facturas=[],$scope.Detalle={};var casillaDeBotones="<div>"+BotonesTabla.Detalles+BotonesTabla.Borrar+BotonesTabla.Imprimir+"</div>";$scope.gridOptions={columnDefs:[{name:"no. orden",field:"consecutivo",width:"10%",minWidth:100},{
name:"fecha",width:"15%",cellTemplate:"<div>{{grid.appScope.convertirFecha(row.entity.fecha)}}</div>",minWidth:100},{field:"subtotal",width:"15%",minWidth:100},{name:"Iva",field:"valorIva",width:"15%",minWidth:100},{field:"total",width:"15%",minWidth:100},{name:"Opciones",enableFiltering:!1,cellTemplate:casillaDeBotones,width:"30%",minWidth:230}]},$scope.print=function(){preloader.estado=!0;var factura={productos:$scope.Orden.productos,cliente:$scope.Orden.cliente,iva:$scope.iva,valorIva:$scope.valorIva,subtotal:$scope.subtotal,total:$scope.total,fecha:Date.now(),vencimiento:$scope.vencimiento,remision:$scope.remision,ordenCompra:$scope.ordenCompra,orden:$scope.Orden._id,consecutivo:$scope.Orden.orden_venta_consecutivo};$scope.remision||$("#remision").html(""),$scope.ordenCompra||$("#ordenCompra").html("");var w=window.open(),d=w.document.open(),eleToPrint=$("#container")[0];d.append(eleToPrint),webServer.getResource("facturas",factura,"post").then(function(data){preloader.estado=!1,sweetAlert("ok",data.data.message,"success"),w.print(),w.close(),$state.go("OrdenVenta")},function(data){preloader.estado=!1,sweetAlert("Oops...",data.data.message,"error"),w.close(),$state.go("OrdenVenta")})},webServer.getResource("orden_venta/"+$state.params._id,{},"get").then(function(data){$scope.Orden=data.data.datos,$scope.calcularTotal()},function(data){$scope.newFactura=!1,$scope.listarFacturas()}),$scope.listarFacturas=function(){webServer.getResource("facturas",{},"get").then(function(data){$scope.Facturas=data.data.datos,$scope.gridOptions.data=$scope.Facturas},function(data){$scope.gridOptions.data=$scope.Facturas,$state.go("OrdenVenta")})},$scope.calcularTotal=function(){$scope.subtotal=0,$scope.Orden.productos.forEach(function(pro){$scope.subtotal+=pro.cantidad*pro.precio}),$scope.calcularIva()},$scope.calcularIva=function(){$scope.valorIva=$scope.subtotal*($scope.iva/100),$scope.total=$scope.subtotal+$scope.valorIva},$scope.covert=function(argument){return numeroaletras.doit(argument)},$scope.convertirFecha=function(fecha){var date=new Date(fecha).getDate();return date+="/"+(new Date(fecha).getMonth()+1),date+="/"+new Date(fecha).getFullYear()},$scope.Detalles=function(id){$scope.Detalle=identificar(id,$scope.Facturas),null!=$scope.Detalle&&$("#modalFacturas").modal("open")},$scope.abrirModal=function(id){var obj=identificar(id,$scope.Facturas);swal({title:"Confirmar Eliminación",text:"¿Esta seguro de borrar la factura?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, Borrar!",cancelButtonText:"No, Cancelar!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?Borrar(obj):swal("Cancelado","La factura no se borrará","error")})},$scope.Imprimir=function(ele){$scope.Orden={orden_venta_consecutivo:ele.consecutivo,cliente:ele.cliente,productos:ele.productos},$scope.remision=ele.remision,$scope.ordenCompra=ele.ordenCompra,$scope.subtotal=ele.subtotal,$scope.iva=ele.iva,$scope.valorIva=ele.valorIva,$scope.total=ele.total,$scope.remision||$("#remision").html(""),$scope.ordenCompra||$("#ordenCompra").html("");var w=window.open(),d=w.document.open(),eleToPrint=$("#container")[0];d.append(eleToPrint),webServer.getResource("facturas",{},"get").then(function(data){w.print(),w.close()},function(data){w.print(),w.close()})}}]),angular.module("frontendApp").constant("server","http://inventory:5000"),angular.module("frontendApp").service("numeroaletras",function(){return{doit:function(number){function Unidades(num){switch(num){case 1:return"UN";case 2:return"DOS";case 3:return"TRES";case 4:return"CUATRO";case 5:return"CINCO";case 6:return"SEIS";case 7:return"SIETE";case 8:return"OCHO";case 9:return"NUEVE"}return""}function Decenas(num){var decena=Math.floor(num/10),unidad=num-10*decena;switch(decena){case 1:switch(unidad){case 0:return"DIEZ";case 1:return"ONCE";case 2:return"DOCE";case 3:return"TRECE";case 4:return"CATORCE";case 5:return"QUINCE";default:return"DIECI"+Unidades(unidad)}case 2:switch(unidad){case 0:return"VEINTE";default:return"VEINTI"+Unidades(unidad)}case 3:return DecenasY("TREINTA",unidad);case 4:return DecenasY("CUARENTA",unidad);case 5:return DecenasY("CINCUENTA",unidad);case 6:return DecenasY("SESENTA",unidad);case 7:return DecenasY("SETENTA",unidad);case 8:return DecenasY("OCHENTA",unidad);case 9:return DecenasY("NOVENTA",unidad);case 0:return Unidades(unidad)}}function DecenasY(strSin,numUnidades){return numUnidades>0?strSin+" Y "+Unidades(numUnidades):strSin}function Centenas(num){var centenas=Math.floor(num/100),decenas=num-100*centenas;switch(centenas){case 1:return decenas>0?"CIENTO "+Decenas(decenas):"CIEN";case 2:return"DOSCIENTOS "+Decenas(decenas);case 3:return"TRESCIENTOS "+Decenas(decenas);case 4:return"CUATROCIENTOS "+Decenas(decenas);case 5:return"QUINIENTOS "+Decenas(decenas);case 6:return"SEISCIENTOS "+Decenas(decenas);case 7:return"SETECIENTOS "+Decenas(decenas);case 8:return"OCHOCIENTOS "+Decenas(decenas);case 9:return"NOVECIENTOS "+Decenas(decenas)}return Decenas(decenas)}function Seccion(num,divisor,strSingular,strPlural){var cientos=Math.floor(num/divisor),resto=num-cientos*divisor,letras="";return cientos>0&&(letras=cientos>1?Centenas(cientos)+" "+strPlural:strSingular),resto>0&&(letras+=""),letras}function Miles(num){var cientos=Math.floor(num/1e3),resto=num-1e3*cientos,strMiles=Seccion(num,1e3,"UN MIL","MIL"),strCentenas=Centenas(resto);return""==strMiles?strCentenas:strMiles+" "+strCentenas}function Millones(num){var cientos=Math.floor(num/1e6),resto=num-1e6*cientos,strMillones=Seccion(num,1e6,"UN MILLON","MILLONES"),strMiles=Miles(resto);return""==strMillones?strMiles:strMillones+" "+strMiles}return function(num){var data={numero:num,enteros:Math.floor(num),centavos:Math.round(100*num)-100*Math.floor(num),letrasCentavos:"",letrasMonedaPlural:"PESOS M/CTE.",letrasMonedaSingular:"PESOS M/CTE."};return data.centavos>0&&(data.letrasCentavos="CON "+data.centavos+"/100"),0==data.enteros?"CERO "+data.letrasMonedaPlural+" "+data.letrasCentavos:1==data.enteros?Millones(data.enteros)+" "+data.letrasMonedaSingular+" "+data.letrasCentavos:Millones(data.enteros)+" "+data.letrasMonedaPlural+" "+data.letrasCentavos}(number)}}}),angular.module("frontendApp").controller("LoginCtrl",["$scope","$state","preloader",function($scope,$state,preloader){$scope.preloader=preloader,$scope.preloader.estado=!1}]);